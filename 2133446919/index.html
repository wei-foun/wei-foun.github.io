<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Linux 基础 | </title><meta name="keywords" content="linux"><meta name="author" content="Legacy"><meta name="copyright" content="Legacy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="系统目录123456789101112131415161718192021222324252627282930313233343536373839# 存放系统常用可执行命令，如 ls，cat，cp 等&#x2F;bin# 存放系统级别的管理命令，如 reboot，iptables 等&#x2F;sbin# 存放系统启动时需要的引导程序文件&#x2F;boot# 表示系统设备目录，如 磁盘&#x2F;dev# 是系统配置文件的目录&#x2F;etc">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux 基础">
<meta property="og:url" content="http://example.com/2133446919/index.html">
<meta property="og:site_name">
<meta property="og:description" content="系统目录123456789101112131415161718192021222324252627282930313233343536373839# 存放系统常用可执行命令，如 ls，cat，cp 等&#x2F;bin# 存放系统级别的管理命令，如 reboot，iptables 等&#x2F;sbin# 存放系统启动时需要的引导程序文件&#x2F;boot# 表示系统设备目录，如 磁盘&#x2F;dev# 是系统配置文件的目录&#x2F;etc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wei-foun.github.io/img/cover46.jpg">
<meta property="article:published_time" content="2025-07-12T06:58:04.000Z">
<meta property="article:modified_time" content="2025-08-23T18:10:36.410Z">
<meta property="article:author" content="Legacy">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wei-foun.github.io/img/cover46.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2133446919/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux 基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-24 02:10:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">55</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 爱好收集</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://wei-foun.github.io/img/cover46.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/"></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 爱好收集</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux 基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-12T06:58:04.000Z" title="发表于 2025-07-12 14:58:04">2025-07-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-23T18:10:36.410Z" title="更新于 2025-08-24 02:10:36">2025-08-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/linux-%E5%9F%BA%E7%A1%80/">linux 基础</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux 基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="系统目录"><a href="#系统目录" class="headerlink" title="系统目录"></a>系统目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 存放系统常用可执行命令，如 ls，cat，cp 等</span></span><br><span class="line">/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存放系统级别的管理命令，如 reboot，iptables 等</span></span><br><span class="line">/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存放系统启动时需要的引导程序文件</span></span><br><span class="line">/boot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示系统设备目录，如 磁盘</span></span><br><span class="line">/dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是系统配置文件的目录</span></span><br><span class="line">/etc</span><br><span class="line">/etc/hostname         <span class="comment"># 主机名</span></span><br><span class="line">/etc/fstab            <span class="comment"># 文件系统挂载信息</span></span><br><span class="line">/etc/ssh/sshd_config  <span class="comment"># SSH 配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户家目录，每个创建的用户都会该目录下有对应目录</span></span><br><span class="line">/home</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存放系统运行时需要的共享库文件</span></span><br><span class="line">/lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一般用户安装的第三方工具目录</span></span><br><span class="line">/opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统虚拟文件，提供系统信息</span></span><br><span class="line">/proc</span><br><span class="line">/proc/cpuinfo <span class="comment"># cpu信息</span></span><br><span class="line">/proc/meminfo <span class="comment"># 内存信息</span></span><br><span class="line">/proc/[pid]/  <span class="comment"># 进程的详细运行信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 存放系统安装的程序，库等</span></span><br><span class="line">/usr</span><br><span class="line">/usr/bin/    <span class="comment"># 用户命令</span></span><br><span class="line">/usr/sbin/   <span class="comment"># 管理员命令</span></span><br><span class="line">/usr/lib/    <span class="comment"># 程序运行库</span></span><br><span class="line">/usr/local/  <span class="comment"># 用户手动安装程序</span></span><br></pre></td></tr></table></figure>
<h3 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h3><p>终端可以分为：tty，pts</p>
<p>Tty（<strong>Teletype</strong>）传统物理终端的抽象，可以分物理 tty，虚拟 tty（<code>/dev/tty1</code>~<code>/dev/tty6</code>），一般本地登录都是使用 tty </p>
<p>Pts （<strong>Pseudo Terminal Slave</strong>）伪终端，最常见的比如 ssh 远程连接，pts 是动态创建，如 <code>/dev/pts/0</code></p>
<p>通过输入 <code>tty</code> 命令，可以查看当前是哪个终端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@LostStars:~<span class="comment"># tty</span></span><br><span class="line">/dev/pts/0</span><br></pre></td></tr></table></figure>
<h3 id="包管理"><a href="#包管理" class="headerlink" title="包管理"></a>包管理</h3><p>常见的 linux 包管理系统有 redhat 的 rpm（包后缀是 .rpm），debian 的 dpkg（包后缀是 .deb）</p>
<p>使用 rpm 安装安装 rpm 包，<code>rpm -i xxxx.rpm</code>，注意使用 rpm 命令安装 rpm 包时无法处理有依赖关系的包</p>
<p>所以就有了 yum/dnf（centos） 和 apt（ubuntu）这种高级的包管理工具，他们可以在安装包的时候自动处理相关的依赖包安装。补充：dnf 是 yum 的继任者，在处理性能上高于 yum</p>
<p>yum/dnf 属于 C/S 架构，yum 服务器存放着 rpm 包和相关包的元数据（存放在特定目录的 repodata 中），linux 客户端使用 yum 安装包时会从服务器的 yum 仓库里得到 repodata 的信息，然后去查找依赖进行下载安装</p>
<p>在机器上有一个仓库的配置目录 <code>/etc/yum.repos.d/</code>，这下面存放着许多以 .repo 结尾的配置文件，每个配置文件里可以配置多个仓库信息， 例如下面的 baseos</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仓库id</span></span><br><span class="line">[baseos]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 仓库1的名字</span></span><br><span class="line">name=CCLinux <span class="variable">$releasever</span> - BaseOS</span><br><span class="line"></span><br><span class="line"><span class="comment"># mirrorlist用于指定镜像服务器的地址列表 </span></span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=<span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=os&amp;infra=<span class="variable">$infra</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指明软件下载路径，其中支持的协议有 http:// ftp:// file:// 三种</span></span><br><span class="line">baseurl=http://yum.bandaoyu.cn/repo/cclinux/lcx/BaseOS/x86_64/os/ </span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-cclinuxofficial </span><br><span class="line"></span><br><span class="line">gpgcheck=1           <span class="comment"># 分别代表是否进行gpg校验，如果没有这一项，默认是检查</span></span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">metadata_expire=6h</span><br><span class="line">countme=1</span><br><span class="line">enabled=1            <span class="comment"># 启用或禁用软件仓库。0表不启用baseurl，为1表启用baseurl路径</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>补充：repo 文件中通常还有 <code>[extras]</code> 和 <code>[epel]</code> 两个仓库 id，前者是用作对没找到的包的补充，后者是对接国外 repo 仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum repolist   <span class="comment"># 查看启用的 repo id， -v 可以查看具体配置信息</span></span><br><span class="line">yum list       <span class="comment"># 查看所有包</span></span><br><span class="line">yum list installed    <span class="comment"># 查看已安装的包， available 可安装，update 可更新</span></span><br><span class="line">yum install xxx       <span class="comment"># 安装指定的包，-y 全部确认安装避免交互</span></span><br><span class="line">yum remove  xxx       <span class="comment"># 卸载指定的包</span></span><br><span class="line">yum update  xxx       <span class="comment"># 更新指定的包</span></span><br><span class="line">yum search  xxx       <span class="comment"># 搜索是否有指定的包</span></span><br><span class="line">yum providers  /etc/scp    <span class="comment"># 查看指定目录是由什么包生成的</span></span><br></pre></td></tr></table></figure>
<h3 id="系统相关命令"><a href="#系统相关命令" class="headerlink" title="系统相关命令"></a>系统相关命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 cpu 信息，可以查看核数，架构，型号等</span></span><br><span class="line">lscpu             <span class="comment"># 信息来自 cat/proc/cpuinfo</span></span><br><span class="line"><span class="built_in">arch</span>              <span class="comment"># 查看系统架构</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内容空间，可以查看总体内存使用率</span></span><br><span class="line">free -h           <span class="comment"># 信息来自 cat /proc/meminfo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看硬盘和分区</span></span><br><span class="line">lsblk -f          <span class="comment"># 查看各硬盘分区和文件系统类型</span></span><br><span class="line"></span><br><span class="line">sudo fdisk -l     <span class="comment"># 列出所有磁盘分区表</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">du</span> -h --max-depth=1   <span class="comment"># 查看当前目录的所有文件夹的大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内核版本</span></span><br><span class="line"><span class="built_in">uname</span> -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看操作系统发行版本</span></span><br><span class="line"><span class="built_in">cat</span> /etc/redhat-release</span><br><span class="line"><span class="built_in">cat</span> /etc/os-release(非红帽系统，例如 ubuntu)</span><br></pre></td></tr></table></figure>
<h4 id="系统内核参数"><a href="#系统内核参数" class="headerlink" title="系统内核参数"></a>系统内核参数</h4><p>​    通过 <code>sysctl -a</code> 可以列出所有内核相关的参数，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@myk8s-control-plane:/<span class="comment"># sysctl -a | grep &quot;icmp&quot;</span></span><br><span class="line">net.ipv4.icmp_echo_enable_probe = 0</span><br><span class="line">net.ipv4.icmp_echo_ignore_all = 0</span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts = 1</span><br><span class="line">net.ipv4.icmp_errors_use_inbound_ifaddr = 0</span><br><span class="line">net.ipv4.icmp_ignore_bogus_error_responses = 1</span><br><span class="line">net.ipv4.icmp_ratelimit = 1000</span><br><span class="line">net.ipv4.icmp_ratemask = 6168</span><br><span class="line">net.ipv4.vs.nat_icmp_send = 0</span><br><span class="line">net.ipv4.vs.schedule_icmp = 0</span><br><span class="line">net.ipv6.icmp.echo_ignore_all = 0</span><br><span class="line">net.ipv6.icmp.echo_ignore_anycast = 0</span><br><span class="line">net.ipv6.icmp.echo_ignore_multicast = 0</span><br><span class="line">net.ipv6.icmp.ratelimit = 1000</span><br><span class="line">net.ipv6.icmp.ratemask = 0-1,3-127</span><br><span class="line">net.netfilter.nf_conntrack_icmp_timeout = 30</span><br><span class="line">net.netfilter.nf_conntrack_icmpv6_timeout = 30</span><br></pre></td></tr></table></figure>
<p>​    举个栗子，<strong>net.ipv4.icmp_echo_ignore_all 参数表示设置是否允许本机可以被其他网络 ping，默认是 0 表示允许，设置为 1 表示拒绝，可以通过</strong> <strong><code>sysctl -w net.ipv4.icmp_echo_ignore_all=1</code></strong> <strong>来开启，但这个操作是暂时的，重启后会恢复原来的配置</strong></p>
<p>​    <strong>所有内核参数设置，可以在 <code>/etc/sysctl.conf</code> 这个文件中配置，然后使用 <code>sysctl -p</code> 重载配置来生效</strong></p>
<p>​    <strong>补充：</strong>每个内核参数其实对应到一个文件，这些文件都在 <code>/proc/sys/</code> 这个目录下，以上面 net.ipv4.icmp_echo_ignore_all 参数来说，其文件路径就是 <code>/proc/sys/net/ipv4/icmp_echo_ignore_all</code></p>
<h5 id="常见的可优化内核参数"><a href="#常见的可优化内核参数" class="headerlink" title="常见的可优化内核参数"></a>常见的可优化内核参数</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness：控制内存不足时页面交换频率，默认值60，建议调整为10-30</span><br><span class="line">vm.overcommit_memory：允许超额分配内存，默认值0（禁止超额分配），建议改为1（允许）</span><br><span class="line">vm.min_free_kbytes：保留最小空闲内存，默认值4096，建议调整为65536</span><br><span class="line">fs.file-max：系统最大可开的文件句柄数，需根据业务需求来修改</span><br><span class="line">fs.nr_open：单进程中最大可开的文件句柄数，这个值需要 &lt; 系统的 file-max</span><br></pre></td></tr></table></figure>
<h4 id="系统日志"><a href="#系统日志" class="headerlink" title="系统日志"></a>系统日志</h4><p>主要有两个命令：dmesg 和 journalctl，另外还有一个 syslog</p>
<ul>
<li>dmesg：主要记录内核和硬件相关的日志，这些信息存储在 <strong>内存缓冲区</strong>（<code>/dev/kmsg</code>），所以一旦重启就无法再看到故障信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dmesg                      <span class="comment"># 查看完整内核日志</span></span><br><span class="line">dmesg -T                   <span class="comment"># 显示人类可读时间戳</span></span><br><span class="line">dmesg | grep <span class="string">&quot;error&quot;</span>       <span class="comment"># 过滤错误信息</span></span><br><span class="line">dmesg -w                   <span class="comment"># 实时监控内核日志</span></span><br></pre></td></tr></table></figure>
<ul>
<li>journalctl：会记录所有 systemd 管理的日志（包括内核、系统服务、应用程序），且数据会持久化存储在 <strong>二进制文件中</strong>（<code>/var/log/journal/</code>）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">journalctl                 <span class="comment"># 查看所有日志</span></span><br><span class="line">journalctl -k              <span class="comment"># 仅内核日志（等效于 dmesg）</span></span><br><span class="line">journalctl -u nginx        <span class="comment"># 查看 nginx 服务日志</span></span><br><span class="line">journalctl --since <span class="string">&quot;2024-01-01&quot;</span> --until <span class="string">&quot;2024-01-02&quot;</span>  <span class="comment"># 按时间筛选</span></span><br><span class="line">journalctl -p err          <span class="comment"># 仅显示错误日志</span></span><br><span class="line">journalctl -f              <span class="comment"># 实时跟踪日志</span></span><br></pre></td></tr></table></figure>
<ul>
<li>syslog：是 Linux 系统的传统日志记录机制，许多系统和应用程序都会使用 <code>syslog</code> 记录日志信息。日志文件通常存储在 <code>/var/log</code> 目录下，默认 systemd-journald 会将日志准发给 rsyslog，所以 syslog 也能查看</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/log/syslog           <span class="comment"># 查看通用系统日志</span></span><br><span class="line">grep <span class="string">&quot;error&quot;</span> /var/log/syslog  <span class="comment"># 文本过滤</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/auth.log     <span class="comment"># 实时监控认证日志</span></span><br></pre></td></tr></table></figure>
<h3 id="Iptabels"><a href="#Iptabels" class="headerlink" title="Iptabels"></a>Iptabels</h3><p>​    Linux 防火墙主要是工作在网络层，用于实现网络包的过滤。防火墙的功能是以 nftables 框架嵌入在 linux 内核中（即内核态），iptables 是属于管理者对防火墙规则配置管理工具（即用户态）</p>
<h4 id="四表五链"><a href="#四表五链" class="headerlink" title="四表五链"></a>四表五链</h4><p>​    Iptables 防火墙规则的配置常常会提到四表五链，四表分别是：filter，nat，raw，mangle（<strong>数据进入防火墙后，会按照 raw→mangle→nat→filter 顺序依次应用各表内的规则</strong>），五链分别是：PREROUTING、POSTROUTING、INPUT、OUTPUT 和 FORWARD</p>
<p><strong>四表的作用：</strong></p>
<ul>
<li>Filter 表：用于实现包，端口过滤</li>
<li>Nat 表：用于地址转发，实现共享地址</li>
<li>Raw 表：允许数据包进行连接跟踪，或绕开连接跟踪时进行自定义的包处理</li>
<li>Mangle 表：用于负责进行封装、拆解包</li>
</ul>
<p><strong>五链的功能：</strong></p>
<p>​    各个链中的默认规则都是 ACCEPT 表示接受数据包，DROP 表示直接丢弃数据包不返回响应，REJECT 表示拒绝数据包但会返回信息。每个链都会有一条默认规则，用来处理该链所有规则都不匹配的情况</p>
<ul>
<li>PREROUTING 链：在数据包进行路由选择前，应用该链的规则</li>
<li>POSTROUTING 链：在数据包返回前，应用该链的规则</li>
<li>INPUT 链：数据包访问防火墙本机入站，会应用该链的规则</li>
<li>OUTPUT 链：防火墙本机应用完成返回数据包出站，会应用该链的规则</li>
<li>FORWARD 链：数据包需要通过进行转发时，会应用该链的规则</li>
</ul>
<p><strong>数据包在防火墙中的处理流程：</strong></p>
<p><img src="https://wei-foun.github.io/img/iptables.jpg" alt=""></p>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p>Iptables 常用的参数描述：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">-L  列出所有规则</span><br><span class="line">-n  以数字形式显示</span><br><span class="line">-t  可以指定查看哪个表的规则，例如 -t nat</span><br><span class="line">--line（--line-number） 列出规则的序号</span><br><span class="line">-s  表示 <span class="built_in">source</span>，访问来源 ip 或 网段</span><br><span class="line">-d  表示 destination，访问目标的 ip 或 网段</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-A  追加规则到最后一行</span><br><span class="line">-I  插入一条规则到第一行</span><br><span class="line"></span><br><span class="line">-D  删除指定序号的规则</span><br><span class="line">-F  清空所有规则</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前节点的 iptables 规则</span></span><br><span class="line">iptables -nL </span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏蔽具体原地址 172.18.0.4 访问本机</span></span><br><span class="line">iptables -I INPUT -s 172.18.0.4 -j REJECT  <span class="comment"># 拒绝访问，返回信息，使用 DROP 也可以</span></span><br><span class="line">iptables -nL</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">REJECT     0    --  172.18.0.4           0.0.0.0/0            reject-with icmp-port-unreachable</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏蔽指定网段的 ip 访问</span></span><br><span class="line">iptables -I INPUT -s 172.18.0.0/16 -j REJECT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拒绝指定网段访问本机 8081 的端口</span></span><br><span class="line">iptables -I INPUT -s 172.18.0.0/16 --dport 8081 -j REJECT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拒绝访问本机多个网段，可以用 -m 使用 multiport 模块去实现</span></span><br><span class="line">iptables -I INPUT -m multiport -p tcp --dport 8081,8082 -j REJECT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只允许指定 172.18.0.0/16 网段访问</span></span><br><span class="line">iptables -I INPUT ! -s 172.18.0.0/16 -j REJECT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据包频率限制，使用 -m limit 模块，--limit 参数设定速率，--limit-burst 设置并发处理数</span></span><br><span class="line">iptables -I INPUT -p icmp -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 10/minute --limit-busrt 5 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 INPUT 链中序号为 1 的规则</span></span><br><span class="line">iptables -D INPUT 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改指定链的默认规则，这里是拒绝所有数据包进入，修改默认前一定需要检查允许的规则是否正确</span></span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 nat 表，设置 snat，将内网地址转为公网地址</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.1.0/24 --to-source &lt;公网 ip&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 nat 表，设置 dnat，同时将用户公网访问端口映射得到内网服务的端口</span></span><br><span class="line">iptables -t nat -A PREROUTING -d &lt;网关或nginx的公网 ip&gt; -p tcp --dport 8080 -j DNAT --to-destnation 172.16.1.2:80</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存当前配置的所有规则</span></span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件恢复规则</span></span><br><span class="line">iptables-restore &lt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure>
<h3 id="Nftables"><a href="#Nftables" class="headerlink" title="Nftables"></a>Nftables</h3><p>​    被称为是 linux iptables 的下一代防火墙，本质上还是基于内核的 netfilter。iptables 防火墙在大规模（比如没有治理做合并的话会导致一个需求存在多条规则造成冗余）下性能会明显下降，且如果是对 ipv6 支持需要通过 ip6tables，arp 包过滤要通过 arptables，网桥包过滤要通过 ebtables</p>
<p>​    nftables，它集成了前面这些分散的过滤模块，并且能够以更加可读的方式进行配置。最重要的是 nftables 在数据结构上进行了调整新增了如 sets 集合，maps 映射 等，要比 iptables 的顺序匹配更加高效，性能也会要好一些</p>
<p>​    <strong><em>一些基础示例：</em></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有规则集</span></span><br><span class="line">sudo nft list ruleset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 ip（v4）的 filter 表中 input 链增加允许 192.168.1.100 访问 80 端口</span></span><br><span class="line">sudo nft add rule ip filter input ip saddr 192.168.1.100 tcp dport 80 accept</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 ip（v4）的 filter 表 input 链里编号为 1 的规则</span></span><br><span class="line">sudo nft delete rule ip filter input handle 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个用于IPv4和IPv6的表，名为 my_firewall</span></span><br><span class="line">sudo nft add table inet my_firewall</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 在表中创建一个名为 my_input_filter 的链，类型是filter，挂载到input钩子，优先级为0</span></span><br><span class="line">sudo nft add chain inet my_firewall my_input_filter &#123; <span class="built_in">type</span> filter hook input priority 0 policy drop &#125;</span><br><span class="line"><span class="comment"># 这里我们还给链设置了默认策略为drop</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 添加规则：允许已建立和相关的连接（ct state 根据状态的匹配）</span></span><br><span class="line">sudo nft add rule inet my_firewall my_input_filter ct state established,related accept</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 添加规则：允许SSH (TCP 22端口) 的新连接</span></span><br><span class="line">sudo nft add rule inet my_firewall my_input_filter tcp dport 22 ct state new accept</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 添加规则：允许HTTP (TCP 80端口) 和 HTTPS (TCP 443端口) 的新连接 (使用集合)</span></span><br><span class="line">sudo nft add <span class="built_in">set</span> inet my_firewall allowed_web_ports &#123; <span class="built_in">type</span> inet_service flags interval &#125;</span><br><span class="line">sudo nft add element inet my_firewall allowed_web_ports &#123; 80, 443 &#125;</span><br><span class="line">sudo nft add rule inet my_firewall my_input_filter tcp dport @allowed_web_ports ct state new accept</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>​    相关参考：<a target="_blank" rel="noopener" href="https://my.oschina.net/emacs_8798835/blog/17289835">https://my.oschina.net/emacs_8798835/blog/17289835</a></p>
<h3 id="I-O-重定向"><a href="#I-O-重定向" class="headerlink" title="I/O 重定向"></a>I/O 重定向</h3><p>​    分为输入 <code>&lt;，&lt;&lt;</code> 和输出 <code>&gt;，&gt;&gt;</code> 重定向，注意 <code>&gt;</code> 覆盖有时是比较危险的操作，可以通过 <code>set -C</code> 命令禁止覆盖重定向</p>
<p>​    标准输入 stdin，标准输出 stdout，标准错误输出 stderr</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; fw.txt &lt;&lt; <span class="string">EOF       # EOF</span> 标准输入重定向，通常用于非编辑下写入到数据到文件</span><br><span class="line">&gt; 12</span><br><span class="line">&gt; 23</span><br><span class="line">&gt; EOF</span><br><span class="line"><span class="built_in">cat</span> fw.txt</span><br><span class="line">12</span><br><span class="line">23</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;name:fw\nage:27&quot;</span> &gt; info.txt   </span><br><span class="line"><span class="comment"># echo -e 参数可以对特殊字符转移，例如这里的 \n</span></span><br><span class="line"><span class="comment"># echo -n 参数表示不换行输出</span></span><br><span class="line"></span><br><span class="line">LS 2&gt; err.txt            <span class="comment"># 将 LS 的错误信息覆盖到 err 文件</span></span><br><span class="line"><span class="comment"># 0 标准输入文件描述符</span></span><br><span class="line"><span class="comment"># 1 标准输出文件描述符</span></span><br><span class="line"><span class="comment"># 2 标准错误输出文件描述符</span></span><br><span class="line"></span><br><span class="line">LS &amp;&gt; info.txt           <span class="comment"># 将 LS 的任何输出信息都覆盖到 info 文件</span></span><br><span class="line"></span><br><span class="line">LS &amp;&gt; /dev/null          <span class="comment"># 将输出信息丢入 &quot;垃圾桶&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=./data.txt bs=1 count=10</span><br><span class="line"><span class="comment"># 从 /dev/zero 设备读取 10 次，每次 1 个字节，写入 data.txt</span></span><br><span class="line"><span class="comment"># 注意，这个 data.txt 的类型是 data，不是文本文件类型</span></span><br><span class="line"><span class="comment"># dd 通常用于磁盘清洗和测试</span></span><br></pre></td></tr></table></figure>
<h3 id="磁盘与文件系统"><a href="#磁盘与文件系统" class="headerlink" title="磁盘与文件系统"></a>磁盘与文件系统</h3><h4 id="磁盘分区类型"><a href="#磁盘分区类型" class="headerlink" title="磁盘分区类型"></a>磁盘分区类型</h4><p>​    常见的磁盘设备的分区会有两种格式：MBR（Master Boot Record），GPT（GUID Partition Table）</p>
<ul>
<li><strong>MBR：有分区数量和分区大小限制，最多创建 4 块分区且每块分区最大不能超过 2.2 TB</strong></li>
<li><strong>GPT：可以支持 128 块分区，且没有单块分区不能超过 2 TB 的限制，是主流的分区格式</strong></li>
</ul>
<p>​    可以用过 <code>fdisk -lu /dev/vdb</code> 查看设备和分区的格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[testuser@ecshost ~]<span class="comment"># sudo fdisk -lu /dev/vdb</span></span><br><span class="line">Disk /dev/vdb: <span class="number">42.9</span> GB, <span class="number">42949672960</span> <span class="built_in">bytes</span>, <span class="number">83886080</span> sectors</span><br><span class="line">Units = sectors of <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="built_in">bytes</span></span><br><span class="line">Sector size (logical/physical): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></span><br><span class="line">I/O size (minimum/optimal): <span class="number">512</span> <span class="built_in">bytes</span> / <span class="number">512</span> <span class="built_in">bytes</span></span><br><span class="line">Disk label <span class="built_in">type</span>: dos                         <span class="comment"># dos 表示 MBR 格式</span></span><br><span class="line">Disk identifier: <span class="number">0x9277b47b</span></span><br><span class="line"></span><br><span class="line">Device Boot Start End Blocks Id System</span><br><span class="line">/dev/vdb1 <span class="number">2048</span> <span class="number">41943039</span> <span class="number">20970496</span> <span class="number">83</span> Linux    <span class="comment"># System = linux 表示该分区是 MBR 分区</span></span><br></pre></td></tr></table></figure>
<p>​    如果是 MBR 分区，后期进行扩容时超过 2TB 的话，需要将 MRB 转为 GPT 格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sgdisk -g /dev/vdb    <span class="comment"># 注意这里是磁盘设备名称，不是带编号的某个分区</span></span><br></pre></td></tr></table></figure>
<h4 id="文件系统类型"><a href="#文件系统类型" class="headerlink" title="文件系统类型"></a>文件系统类型</h4><p>​    文件系统类型常见的有：ext4，xfs</p>
<ul>
<li>ext4：是经过前几台 ext 优化后最常用的文件系统格式，支持更大的文件系统和文件，适用于服务器，桌面系统和嵌入式设备</li>
<li>xfs：支持非常大的文件系统，且擅长存储和处理大型文件，适用于云存储，数据中心存储这类高性能存储处理场景</li>
</ul>
<h4 id="Inode"><a href="#Inode" class="headerlink" title="Inode"></a>Inode</h4><p>​    一个文件除了将内容存储在 block，系统还需要存储文件的元信息，例如大小、创建者、创建时间、访问时间等，所以一个文件会有一个对应的元信息 inode，这个 inode 有一个唯一的标识数字，所以即使文件重命名或迁移到其他目录，都不影响该文件的 inode 号</p>
<p>Linux 上可以通过 <code>stat</code> 命令查看到文件的元信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(.venv) ➜  cdosapi <span class="built_in">stat</span> ~/test.txt</span><br><span class="line">  File: /home/fw/test.txt</span><br><span class="line">  Size: 4               Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 820h/2080d      Inode: 2071457     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: ( 1000/      fw)   Gid: ( 1000/      fw)</span><br><span class="line">Access: 2024-02-02 15:06:54.823403525 +0800</span><br><span class="line">Modify: 2024-02-02 15:06:54.823403525 +0800</span><br><span class="line">Change: 2024-02-02 15:06:54.833403444 +0800</span><br><span class="line"> Birth: 2024-02-02 15:06:54.823403525 +0800</span><br></pre></td></tr></table></figure>
<p> linux 中允许多个文件名去指向一个 inode，所以 <strong>当使用硬链接</strong> <strong><code>ln target_file_name origin_file_name</code></strong> <strong>将源文件指向在目标文件时，通过目标文件依然可以访问，硬链接创建后，两个文件都是一个 inode 号，不同之处就是该 inode 记录的链接数会 +1；硬链接中，文件被删除后不会影响到另一个文件的访问，只会将 inode 中记录的链接数 -1</strong></p>
<p>​    <strong>当使用软链接</strong> <strong><code>ln -s origin_file_or_directory target_file_or_directory</code></strong> <strong>创建新文件或目录，两个文件的 inode 是不一样的，但目标和源文件存在依赖关系，新文件的文件名会指向源文件的文件名，而不是 inode。当源文件被删除后，新文件就无法访问到数据</strong></p>
<p>​    当使用 <code>mkdir</code> 创建一个空目录后，这个目录会有两个链接数，一个是目录名自己，还有一个目录中的隐藏目录 <code>.</code></p>
<p>​    当用户使用文件名访问时，系统会根据这个文件名找到对应 inode 号，通过根据 inode 号得到文件的 inode 信息，最后找到文件数据所在的扇区 block，同时会先对用户的权限进行校验，不满足时就直接拒绝</p>
<p>​    inode 的号的查看除了使用 <code>start file</code>，也可以使用 <code>ls -i</code> 命令，该命令会显示当前目录下的文件夹和文件的 inode</p>
<p>​    另外，系统在磁盘格式化后，会将硬盘分为数据区和 inode 区，之后分区的 inode 数就固定了，可以通过 <code>df -i</code> 的 <code>IUsed</code> 查看各分区的 inode 使用情况</p>
<p>​    <strong>！注意！分区中的 inode 如果使用完了，就无法再创建文件了，即使分区内还有剩余空间</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">总结：</span><br><span class="line"> - 硬链接文件与源文件 inode 一致，软链接文件与源文件 inode 不一致</span><br><span class="line"> - 硬链接不能对目录创建链接，目录链接需要使用软链接</span><br><span class="line"> - 硬链接不能跨文件系统，软链接则可以</span><br><span class="line"> - 删除软链接文件，对源文件访问无影响；删除源文件，则软链接的文件将失效，变成红色</span><br><span class="line"> - 删除硬链接文件，对源文件访问无影响；删除源文件，仍然访问硬链接文件；所以对于硬链接和源文件一起删除，才算是彻底删除</span><br></pre></td></tr></table></figure>
<h3 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h3><p>​    Redundant Array of Independent Disks，独立磁盘冗余阵列。是一种通过组合多个物理磁盘来提升性能、可靠性或两者兼顾的存储技术</p>
<p>​    RAID 主要利用数据条带、镜像和数据校验技术来获取高性能、可靠性、容错能力和扩展性，根据运用或组合运用这三种技术的策略和架构，可以把 RAID 分为不同的等级，以满足不同数据应用的需求</p>
<p>​    RAID 0：通过数据条带（Data Stripping），将数据分块后存储在不同磁盘上，拥有非常高效的写入性能，但是并不具备冗余和恢复能力，<strong>可用空间是：最小磁盘 * 磁盘数 n（&gt;=2）</strong></p>
<p><img src="https://wei-foun.github.io/img/raid0.jpg" alt="img"></p>
<p>​    RAID 1：镜像（Mirror），磁盘写入数据时，会将数据无差异写入两块磁盘上，实现在 RAID 0 基础上拥有了冗余和恢复能力，但是磁盘使用率也降低了一半，且成本非常高，<strong>可用空间是：最小磁盘 * 磁盘数/n（n&gt;=2）</strong></p>
<p><img src="https://wei-foun.github.io/img/raid1.jpg" alt="img"></p>
<p>​    RAID 5：在 RAID 3 和 RAID 4 的数据校验（Data parity）的升级，数据分块写入多块磁盘时，会有一块磁盘用于存储数据的校验信息，这样在故障时通过正常的数据和奇偶校验码来计算出故障磁盘上的数据，兼顾了存储性能、数据安全和存储成本等各个方面因素，<strong>可用空间是：最小磁盘 * 磁盘数 n-1（n&gt;=3）</strong></p>
<p><img src="https://wei-foun.github.io/img/raid5.jpg" alt="img"></p>
<p>​    RAID 6：可以看做是 RAID 5 的扩展版，通过增加一块磁盘和双重校验技术来存储两份校验信息，允许出现两块磁盘故障也能够保持阵列继续正常工作，虽然读取性能和可用性更高，但是写入和成本也比 RAID 5 要更高，<strong>可用空间是：最小磁盘 * 磁盘数 n-2（n&gt;=4）</strong></p>
<p><img src="https://wei-foun.github.io/img/raid6.jpg" alt="img"></p>
<p>​    RAID 01：RIAD 级别都各自有优缺点，因此也出现将各级别组合起来的使用，RAID 01，即结合条带化和镜像，数据写入将会同时写两份到非底层组合的两块磁盘上，实现在上层组合的镜像达到数据冗余和恢复，<strong>可用空间是：最小磁盘 * 磁盘数（n&gt;=4）</strong></p>
<p><img src="https://wei-foun.github.io/img/raid01.jpg" alt="img"></p>
<p>​    RAID 10：和 RAID 01 的组合模式相反，数据分块写入到非底层组合的两块磁盘，同时底层组合的 RAID 1 将会利用镜像实现冗余，<strong>可用空间是：最小磁盘 * 磁盘数/2（&gt;=4）</strong></p>
<p><img src="https://wei-foun.github.io/img/raid10.jpg" alt="img"></p>
<p><img src="https://wei-foun.github.io/img/raid%E5%AF%B9%E6%AF%94.jpg" alt="img"></p>
<h3 id="LVM（logical-volume-manager）"><a href="#LVM（logical-volume-manager）" class="headerlink" title="LVM（logical volume manager）"></a>LVM（logical volume manager）</h3><p>逻辑卷管理，是一种对传统磁盘分区的一种抽象实现。传统磁盘挂载后，经过分区（连续空间才可以做分区）大小就被固定了，一旦后期业务发展磁盘空间不够存储，需要另加磁盘来扩容分区，再扩容文件系统，这对生产环境来说不具备弹性需求</p>
<p>所以就出现了 lvm 逻辑卷管理，它的特点就是可以实现动态扩展和缩容逻辑卷，提升虚机磁盘的灵活管理</p>
<p>Lvm 涉及以下概念：</p>
<ul>
<li>PV（physical volume）：物理卷，是存储的基本单元，可以是实际磁盘或磁盘的分区，也可以是 RAID</li>
<li>VG（volume group）：卷组，可以由一个或多个物理卷组合，或者是多个分区组合，在文件系统中会 <code>/dev/VG_NAME</code> 这种形式表示，可以理解为是一个逻辑磁盘</li>
<li>PE（physical extent）：物理扩展，是卷组中空间最小分配单元，一个 PE 是 4M 的大小，对于 VG 来说就是由多个 PE 组成的</li>
<li>LV （logical volume）：逻辑卷，基于 VG 之上进行的逻辑分区，一般会是 <code>/dev/VG_NAME/LV_NAME</code> 这种形式</li>
</ul>
<p><img src="https://wei-foun.github.io/img/lvm.jpg" alt="img"></p>
<p>​    LVM 的基本命令：</p>
<p><img src="https://wei-foun.github.io/img/lvm-cmd.jpg" alt="img"></p>
<p>实践：</p>
<ul>
<li>假设给虚机新挂载了一个 20G 磁盘，用来做 LVM，这个磁盘对应的设备名称是 /dev/sdb</li>
<li>先对这个 /dev/sdb 这个设备进行分区，分三个区（分区数量自定），大小分别是 10G，5G，5G。这个步骤就是正常设备分区操作，这是第一个分区的示例</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write commad.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 20 GB, 2147483648 bytes, 83886080 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x2b31a2a3</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (1-4, default 1): 1</span><br><span class="line">First sector (41943040-83886079, default 41943040):</span><br><span class="line">Using default value 41943040</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (41943040-83886079, default 83886079): +10G</span><br><span class="line">Using default value 83886079</span><br><span class="line">Partition 1 of <span class="built_in">type</span> Linux and of size 10 GiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
<ul>
<li>完成后，通过 lsblk 可以查看设备对应分区信息，大致如下</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sdb</span><br><span class="line">|-- sdb1</span><br><span class="line">|-- sdb2</span><br><span class="line">|-- sdb3</span><br></pre></td></tr></table></figure>
<ul>
<li>分别对三个分区，使用 <code>pvcreate</code> 命令创建对应的 PV 物理卷。可以通过 <code>pydisplay</code> 查看 PV 的详细信息，如 pv size，uuid，pv 名等</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvcreate  /dev/sdb1 /dev/sdb2 /dev/sdb3</span><br></pre></td></tr></table></figure>
<ul>
<li>PV 创建后，使用 <code>vgcreate &lt;vg name&gt; &lt;pv&gt;</code> 对物理卷创建 VG 卷组。可以通过 <code>vgdisplay</code> 查看 VG 的详细信息，如 vg size，cur pv（表示 vg 里有几个 pv），vg uuid 等，还可以通过 <code>pvs</code> 查看到每个 pv 是属于哪个 vg</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vgcreate VG1 /dev/sdb1 </span><br><span class="line">vgcreate VG2 /dev/sdb2 /dev/sdb3    <span class="comment"># /dev/sdb2 /dev/sdb3 这两个 PV 都会在 VG2 这个卷组中</span></span><br></pre></td></tr></table></figure>
<ul>
<li>VG 创建后，可以使用 <code>lvcreate -L &lt;size&gt; &lt;vg name&gt; -n &lt;lv name&gt;</code>。同样可以通过 <code>lvdisplay /dev/VG1/LV1</code> 查看指定 LV 的详细信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L 10G VG1 -n LV1</span><br><span class="line">lvcreate -L 5G VG2 -n LV2</span><br><span class="line">lvcreate -L 5G VG2 -n LV3</span><br></pre></td></tr></table></figure>
<ul>
<li>LV 完成后，就是回到正常的文件系统格式化操作，以及创建目录挂载，就可以正常使用逻辑卷了</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/VG1/LV1</span><br><span class="line"><span class="comment"># 可能还会见到 mkfs.ext4 /dev/mapper/VG1-LV1</span></span><br><span class="line"><span class="comment"># 因为 /dev/VG1/LV1 和 /dev/mapper/VG1-LV1 都是软链接，都是指向到 dm-序号 的逻辑卷</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /lv1-mnt</span><br><span class="line">mount /dev/VG1/LV1 /lv1-mnt</span><br></pre></td></tr></table></figure>
<ul>
<li>还需要修改 fstab，实现重启自动挂载</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改/etc/fstab 永久挂载</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line"><span class="comment"># 在最后一行添加</span></span><br><span class="line">/dev/VG1/LV1 /lv1-mnt ext4 defaults 0 0</span><br></pre></td></tr></table></figure>
<ul>
<li>当 VG 空间资源不足时，需要扩容 VG 时，可以使用 <code>vgextend &lt;vg name&gt; &lt;pv&gt;</code>，如果要移除 VG，可以使用 <code>vgreduce &lt;vg name&gt; &lt;pv&gt;</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgextend VG1 /dev/sdb3  <span class="comment"># 将 pv /dev/sdb3 的空间给到 VG1 上</span></span><br></pre></td></tr></table></figure>
<ul>
<li>同理，如果 LV 空间不足，可以使用 <code>lvextend -L +size /dev/vg-name/lv-name</code>，然后使用 <code>resize2fs</code> 来扩容文件系统</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lvextend +L +2G /dev/VG1/LV1</span><br><span class="line">reszie2fs /dev/VG1/LV1   <span class="comment"># xfs 文件系统使用 xfs_growfs $&#123;LV_Path&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份当前目录中指定文件</span></span><br><span class="line"><span class="built_in">cp</span> home/cdosapi/docker-compose.yaml&#123;,.bak&#125;</span><br><span class="line"><span class="comment"># 等同于 cp home/cdosapi/docker-compose.yaml home/cdosapi/docker-compose.yaml.bak</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> $?  <span class="comment"># 获取上一条执行命令的退出码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看磁盘是否是纯净盘</span></span><br><span class="line">sudo file -s /dev/nvme1n1</span><br><span class="line">/dev/nvme1n1: data          <span class="comment"># 表示没有进行初始化分区</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前文件夹的大小</span></span><br><span class="line"><span class="built_in">du</span> -sh</span><br><span class="line"><span class="comment"># 显示当前文件夹中所有文件和文件夹的大小</span></span><br><span class="line"><span class="built_in">du</span> -ah</span><br><span class="line"><span class="comment"># 显示当前文件夹中所有文件和文件夹的大小，并按照大小进行排序</span></span><br><span class="line"><span class="built_in">du</span> -ah | <span class="built_in">sort</span> -rh</span><br><span class="line"><span class="comment"># 显示当前文件夹及其子文件夹的大小，并按照大小进行排序</span></span><br><span class="line"><span class="built_in">du</span> -h --max-depth=1 | <span class="built_in">sort</span> -rh</span><br><span class="line"><span class="comment"># 显示当前目录下，第一层目录的大小</span></span><br><span class="line"><span class="built_in">du</span> --max-depth=1 -h</span><br><span class="line"><span class="comment"># 按 G 显示当前最大的文件</span></span><br><span class="line"><span class="built_in">du</span> -shc *|grep G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入一个 2G 的文件 hello.txt 在 / 目录 </span></span><br><span class="line">sudo <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero  of=/hello.txt  bs=1M count=2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前目录下查找文件，且后缀为 .pdf</span></span><br><span class="line">find ./ -<span class="built_in">type</span> f -name <span class="string">&quot;*.pdf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前目录下查找文件（-type d 表示目录），文件的属性修改时间为过去 5-10 天内的</span></span><br><span class="line">find ./ -<span class="built_in">type</span> f -ctime +5 -ctime -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全关闭系统</span></span><br><span class="line">halt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 立即关机，有 -r 参数的，表示 reset 立即重启</span></span><br><span class="line">shutdown now</span><br></pre></td></tr></table></figure>
<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><p>Linux 上对于 shell，python 这种解释型语言，可以使用 <code>./test.sh</code> 这种当前方式执行，当然也可以使用绝对路径。这种方式会检查是否有文件执行权，只有满足才能执行，否则会报错 <code>Permission denied</code></p>
<p>还有一种方式是通过 <code>bash test.sh</code> 执行，这种方式不需要执行权</p>
<p>另外，通过 <code>bash -x test.sh</code> 可以将脚本内的每个命令单步执行输出，通常用于脚本调试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@LostStars:~<span class="comment"># bash -x test.sh</span></span><br><span class="line">+ <span class="built_in">pwd</span></span><br><span class="line">/root</span><br><span class="line">+ <span class="built_in">ls</span> -al</span><br><span class="line">total 44</span><br><span class="line">drwx------  5 root root 4096 Mar 30 20:52 .</span><br><span class="line">drwxr-xr-x 19 root root 4096 Mar 30 20:02 ..</span><br><span class="line">-rw-------  1 root root 4526 Mar 29 03:20 .bash_history</span><br><span class="line">-rw-r--r--  1 root root 3106 Oct 15  2021 .bashrc</span><br><span class="line">drwx------  2 root root 4096 Dec  8 14:20 .cache</span><br><span class="line">-rw-r--r--  1 root root    0 Mar 30 20:02 .motd_shown</span><br><span class="line">-rw-r--r--  1 root root  161 Jul  9  2019 .profile</span><br><span class="line">-rw-------  1 root root 1822 Mar 30 20:52 .viminfo</span><br><span class="line">drwxr-xr-x  2 root root 4096 Feb  2 13:13 docker</span><br><span class="line">drwxr-xr-x  2 root root 4096 Feb  2 12:39 feng_wei</span><br><span class="line">-rw-r--r--  1 root root   23 Mar 30 20:52 test.sh</span><br></pre></td></tr></table></figure>
<p>在执行脚本前，还可以使用 <code>bash -n test.sh</code> 来检查脚本是否有语法错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@LostStars:~<span class="comment"># bash -n test.sh</span></span><br><span class="line">test.sh: line 4: unexpected EOF <span class="keyword">while</span> looking <span class="keyword">for</span> matching `<span class="string">&quot;&#x27;</span></span><br><span class="line"><span class="string">test.sh: line 5: syntax error: unexpected end of file</span></span><br></pre></td></tr></table></figure>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>通常变量输出使用 echo 打印变量，一般都是 <code>echo $name</code>，如果是要格式化打印输出，例如对字符串变量做拼接等，就需要使用 <code>echo $&#123;exec_time&#125;s</code></p>
<p>另外，linux 中单引号和双引号也是有区别的。单引号是强引用，如果变量在单引号内，则不会替换得到变量值；而双引号是弱引用，会自动替换得到变量值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@LostStars</span>:<span class="operator">~</span># exec_time<span class="operator">=</span><span class="number">10</span></span><br><span class="line">root<span class="variable">@LostStars</span>:<span class="operator">~</span># echo $&#123;exec_time&#125;s</span><br><span class="line"><span class="number">10</span>s</span><br><span class="line">root<span class="variable">@LostStars</span>:<span class="operator">~</span>#</span><br><span class="line">root<span class="variable">@LostStars</span>:<span class="operator">~</span># echo &quot;$&#123;exec_time&#125;s&quot;</span><br><span class="line"><span class="number">10</span>s</span><br><span class="line">root<span class="variable">@LostStars</span>:<span class="operator">~</span># echo <span class="string">&#x27;$&#123;exec_time&#125;s&#x27;</span></span><br><span class="line">$&#123;exec_time&#125;s</span><br></pre></td></tr></table></figure>
<p>还有反引号，这种用于引用反引号内命令执行的结果，有时候也会是 <code>$()</code> 这种形式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@LostStars:~<span class="comment"># cp test.sh test.sh.`date +%F`  # 等同于 test.sh.$(date +%F)</span></span><br><span class="line">root@LostStars:~<span class="comment"># ll</span></span><br><span class="line">-rw-r--r--  1 root root   33 Mar 30 20:56 test.sh</span><br><span class="line">-rw-r--r--  1 root root   33 Mar 30 21:08 test.sh.2025-03-30</span><br></pre></td></tr></table></figure>
<p>注意，shell 中变量是区分大小写，且复制时等号两边不能有空格</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>创建一个临时环境变量，可以通过 <code>export admin=fw</code> 去设定，这只对当前窗口有效。通过是修改系统 env 变量中定义的环境变量，也只会在当前窗口终端有效</p>
<p>系统环境变量根据登录方式有两类：</p>
<p>交互式登录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile --&gt; /etc/profile.d/xxxx.sh --&gt; home 目录下 .bash_profile --&gt; 当前登录用户的.bashrc --&gt; /etc/bashrc</span><br></pre></td></tr></table></figure>
<p>非交互登录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">home 目录下 .bashrc --&gt; /etc/bashrc --&gt; /etc/profile.d/xxx.sh</span><br></pre></td></tr></table></figure>
<h4 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a>位置变量</h4><p>有时执行一个 shell 脚本会需要传递参数，这时脚本内可用 $1 , $2 这种方式来分别接收指定位置的参数。如果参数很多，超过 9 个参数时，第十个参数在 shell 脚本内需要使用 <code>param_10=$&#123;10&#125;</code> 来表示</p>
<p>对于 $0 来说，这是一个特殊变量，在执行脚本时 $0 就是脚本文件名</p>
<p><strong>补充几个关于 $ 的特殊用法：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$?   <span class="comment"># 用于显示上一条命令的执行状态，0 表示成功</span></span><br><span class="line"><span class="variable">$#</span>   <span class="comment"># 显示所有参数的总个数</span></span><br><span class="line">$*   <span class="comment"># 依次显示每一个参数</span></span><br></pre></td></tr></table></figure>
<h4 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h4><p>Linux 的 if 分支逻辑结构如下，if 开头 fi 结尾，除了 else 之外的逻辑分支结尾需要有 <code>; then</code> 并换行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$1</span> -gt 5 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;value <span class="variable">$a</span> &gt; 5&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> (( <span class="variable">$a</span> &lt; 0 )); <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;error: vale less than zero&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> (( <span class="variable">$a</span> &gt;= 0 || <span class="variable">$a</span> &lt;= 5 )); <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;correct: value is valid&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p><code>if [ condition ]</code> 和 <code>if (( expression ))</code> 都是支持运算逻辑的判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if [ condition ]` 支持 `-eq, -ne, -le, -lt, -ge, -gt` 运算符比较，字符串比较可以使用 `=, !=</span><br></pre></td></tr></table></figure>
<p><code>if (( expression ))</code> 支持 <code>&lt;, &gt;, &lt;=, &gt;=, ==, !=</code> 运算符更类似平常代码，但不能用来比较字符串</p>
<p>If 分支还有另外两种形式：<code>if command</code> 和 <code>if [[ condition ]]</code></p>
<p><code>if command</code> 即可以直接以命令的退出码来进行判断，正确执行退出是 0，异常退出就是非 0</p>
<p><code>if [[ condition ]]</code> 是 bash shelll 的扩展形式，支持正则，通配符这些</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">keys=(<span class="string">&quot;name&quot;</span> <span class="string">&quot;age&quot;</span> <span class="string">&quot;address&quot;</span>)</span><br><span class="line"><span class="comment"># 一般见到的数组格式都是 (&quot;name&quot; &quot;age&quot; &quot;address&quot;)，使用空格做分割</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot; <span class="variable">$&#123;keys[@]&#125;</span> &quot;</span> =~ <span class="string">&quot; <span class="variable">$a</span> &quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># $&#123;keys[@]&#125; 依次拿到 name 和 age 以及 address </span></span><br><span class="line">    <span class="comment"># =~ 表示使用正则判断，只能在 if 或 case 中使用</span></span><br><span class="line">    <span class="comment"># =~ 的左边是变量，右边是正则表达式</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> in&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span> not in&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>除了 if 分支，还有一种是确定值选择的分支 case</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">name=fw</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$name</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;wf&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;not find user&quot;</span></span><br><span class="line">        ;;      <span class="comment"># 每个 case 块最后都需要 ;; </span></span><br><span class="line">    <span class="string">&quot;fw&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;find user&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;exit&quot;</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span>       <span class="comment"># 循环 1 到 10</span></span><br><span class="line">    useradd user<span class="variable">$i</span> &amp;&gt; /dev/null    </span><br><span class="line">    <span class="comment"># 创建 user1 - user10，并将 stdout 和 stderr 输出重定向到 /dev/null 即丢弃输出信息</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> -l /var/log/cdosapi/access.log*`; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># for 循环的列表也是是来自命令的结果</span></span><br><span class="line">    <span class="built_in">basename</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------</span><br><span class="line">count=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -lt 10 ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n -e <span class="string">&quot;<span class="variable">$count</span>\t&quot;</span></span><br><span class="line">    <span class="built_in">let</span> count+=1</span><br><span class="line">    <span class="comment"># while 中也支持使用 continue 和 break</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>补充：seq 命令可以用来遍历元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@LostStars:~<span class="comment"># seq -s+ 0 10        # -s 参数后面的支持 +， -， *， /， % </span></span><br><span class="line">0+1+2+3+4+5+6+7+8+9+10</span><br><span class="line">root@LostStars:~<span class="comment"># seq -s+ 0 10 | bc</span></span><br><span class="line">55</span><br></pre></td></tr></table></figure>
<h3 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 ## 删除最长前缀</span></span><br><span class="line">➜  ~ url=http://10.62.214.27:80/api/v3/vm/mybase_remedydata</span><br><span class="line">➜  ~ <span class="built_in">echo</span> <span class="variable">$&#123;url##*$&#x27;/&#x27;&#125;</span></span><br><span class="line">mybase_remedydata</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 # 删除最短前缀</span></span><br><span class="line">➜  ~ <span class="built_in">echo</span> <span class="variable">$&#123;url#*$&#x27;/&#x27;&#125;</span></span><br><span class="line">/10.62.214.27:80/api/v3/vm/mybase_remedydata</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 %% 删除最长前缀</span></span><br><span class="line">➜  ~ <span class="built_in">echo</span> <span class="variable">$&#123;url%%$&#x27;/&#x27;*&#125;</span></span><br><span class="line">http:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 % 删除最短后缀</span></span><br><span class="line">➜  ~ <span class="built_in">echo</span> <span class="variable">$&#123;url%$&#x27;/&#x27;*&#125;</span></span><br><span class="line">http://10.62.214.27:80/api/v3/vm</span><br></pre></td></tr></table></figure>
<h4 id="正则匹配文件内容进行替换"><a href="#正则匹配文件内容进行替换" class="headerlink" title="正则匹配文件内容进行替换"></a>正则匹配文件内容进行替换</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cicode=<span class="variable">$1</span></span><br><span class="line">ip=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line">vms_regex=<span class="string">&#x27;(VMSALI|VMSAWS)[0-9]&#123;8&#125;&#x27;</span></span><br><span class="line">ip_regex=<span class="string">&#x27;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed -Ei \</span><br><span class="line">  -e <span class="string">&quot;s/(VMSALI|VMSAWS)[0-9]&#123;8&#125;/<span class="variable">$cicode</span>/g&quot;</span> \</span><br><span class="line">  -e <span class="string">&quot;s/([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;/<span class="variable">$ip</span>/g&quot;</span> \</span><br><span class="line">  /home/fw/inventory.yaml</span><br></pre></td></tr></table></figure>
<h3 id="文本处理-grep-sed-awk"><a href="#文本处理-grep-sed-awk" class="headerlink" title="文本处理 grep | sed | awk"></a>文本处理 grep | sed | awk</h3><p>Linux 操作文本的三大利器分别是 grep、sed 、awk，简称三剑客：</p>
<p>awk：最擅长取列，默认是按照空格对内容分列</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照 # 分割内容，并输出第 1,2 列信息</span></span><br><span class="line">awk -F <span class="string">&quot;#&quot;</span> <span class="string">&quot;&#123;print <span class="variable">$1</span>,<span class="variable">$2</span>&#125;&quot;</span> api.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照 # 分割内容，且能分割出 5 列内容时，输出第 1 列信息</span></span><br><span class="line">awk -F <span class="string">&#x27;#&#x27;</span> <span class="string">&#x27;NF==5 &#123;print $1&#125;&#x27;</span> api.log</span><br><span class="line"></span><br><span class="line">awk -F <span class="string">&#x27;#&#x27;</span> <span class="string">&#x27;NF&gt;=4 &amp;&amp; NF&lt;=5 &#123;print $1&#125;&#x27;</span> api.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照 # 分割内容，得到文件中第 5 行的第 1 列信息</span></span><br><span class="line">awk -F <span class="string">&#x27;#&#x27;</span> <span class="string">&#x27;NR==5 &#123;print $1&#125;&#x27;</span> api.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分析 nginx 访问日志，找出访问页面数量在 top10 的 ip</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> access.log | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">head</span> -n 10</span><br></pre></td></tr></table></figure>
<p>sed：最擅长取行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出文件的第 2 行</span></span><br><span class="line">sed -n 2p api.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出第 2 到 5 行</span></span><br><span class="line">sed -n 2,5p api.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局替换，将 hello 替换为 hi</span></span><br><span class="line">sed -i <span class="string">&#x27;s/hello/hi/g&#x27;</span> api.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 -E 通过正则匹配来替换为指定变量值</span></span><br><span class="line">cicode=<span class="variable">$1</span></span><br><span class="line">ip=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line">sed -Ei \</span><br><span class="line">  -e <span class="string">&quot;s/(VMSALI|VMSAWS)[0-9]&#123;8&#125;/<span class="variable">$cicode</span>/g&quot;</span> \</span><br><span class="line">  -e <span class="string">&quot;s/([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;/<span class="variable">$ip</span>/g&quot;</span> \</span><br><span class="line">  /home/fw/inventory.yaml</span><br></pre></td></tr></table></figure>
<p>grep：最擅长过滤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 api.log 文件中 error 字符串之后的 10 行内容</span></span><br><span class="line">grep -A 10 <span class="string">&quot;error&quot;</span> api.log      <span class="comment"># -B 10 表示之前的 10 行    -C 10 表示上下 10 行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果内容太多，通过 管道符 less 可以分页用上下键查看</span></span><br><span class="line"><span class="comment"># 使用 /except 可以进行二次搜索</span></span><br><span class="line"><span class="comment"># q 键退出分页显示</span></span><br><span class="line">grep -A 10 <span class="string">&quot;error&quot;</span> api.log | less</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 -H 可以显示具体哪个文件由对应信息</span></span><br><span class="line">grep -H <span class="string">&quot;error&quot;</span> *.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤出 error 信息的行，并显示行号</span></span><br><span class="line">grep -n <span class="string">&quot;error&quot;</span> api.log</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 应用服务通过 logrotate 进行日志轮转压缩 gz 包</span></span><br><span class="line">zgrep -i <span class="string">&quot;error&quot;</span> *.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep 统计字符出现次数</span></span><br><span class="line">grep -o <span class="string">&quot;要搜索的字符串&quot;</span> 文件名 | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则匹配</span></span><br><span class="line">grep -E <span class="string">&quot;warning|error&quot;</span> api.log</span><br></pre></td></tr></table></figure>
<h3 id="base64-编解码"><a href="#base64-编解码" class="headerlink" title="base64 编解码"></a>base64 编解码</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编码</span></span><br><span class="line"><span class="string">root@LostStars:~#</span> <span class="string">echo</span> <span class="string">-n</span> <span class="string">&quot;founwei&quot;</span> <span class="string">|</span> <span class="string">base64</span></span><br><span class="line"><span class="string">Zm91bndlaQ==</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解码</span></span><br><span class="line"><span class="string">root@LostStars:~#</span> <span class="string">echo</span> <span class="string">-n</span> <span class="string">&quot;Zm91bndlaQ==&quot;</span> <span class="string">|</span> <span class="string">base64</span> <span class="string">-d</span></span><br><span class="line"><span class="string">founweiroot@LostStars:~#</span></span><br></pre></td></tr></table></figure>
<h3 id="Repo-变量查看"><a href="#Repo-变量查看" class="headerlink" title="Repo 变量查看"></a>Repo 变量查看</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VMSALI01832180 ~]<span class="comment"># yum config-manager --dump-variables</span></span><br><span class="line"><span class="built_in">arch</span> = x86_64</span><br><span class="line">basearch = x86_64</span><br><span class="line">stream = 9-stream</span><br><span class="line">ops_mirror = 10.29.194.239</span><br><span class="line">ctrip_release = 9.2</span><br><span class="line">ctrip_custom = custom</span><br><span class="line">releasever = 9</span><br></pre></td></tr></table></figure>
<h3 id="web-服务器压测"><a href="#web-服务器压测" class="headerlink" title="web 服务器压测"></a>web 服务器压测</h3><p>​    可以使用 ab（apache benchmark）命令做性能测试，比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置总请求 500 个，并发数为 20</span></span><br><span class="line">ab -n 500 -c 20 http://localhost:8080/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 -t 参数，指定一个持续压测时间，这个单位是秒</span></span><br><span class="line"><span class="comment"># 通过 -k 参数，表示开启 http 的 keepalive 会话保持</span></span><br><span class="line"><span class="comment"># 通过 -p 参数，可以测试 post 请求，-p 后加上 post 请求体的数据</span></span><br></pre></td></tr></table></figure>
<p>​    对出输出信息，其中关注的指标主要是 <strong>Requests per second</strong>，这个值就是 qps；<strong>Time per request</strong>，这个是请求平均的处理时间；<strong>Percentage served</strong>，这个会按照不同耗时的请求列出对应的百分比</p>
<p>​    通常情况下，ab 压测需要进行多次，每次都可以修改并发和请求数，来查看是否有异常波动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span></span><br><span class="line">  ab -n 1000 -c $((i*<span class="number">20</span>)) http://localhost:8080/ &gt;&gt; results.txt</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h4 id="通过-curl-查看请求各阶段耗时"><a href="#通过-curl-查看请求各阶段耗时" class="headerlink" title="通过 curl 查看请求各阶段耗时"></a>通过 curl 查看请求各阶段耗时</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">curl -w <span class="string">&#x27;\n time_namelookup=%&#123;time_namelookup&#125;\n time_connect=%&#123;time_connect&#125;\n time_appconnect=%&#123;time_appconnect&#125;\n time_redirect=%&#123;time_redirect&#125;\n time_pretransfer=%&#123;time_pretransfer&#125;\n time_starttransfer=%&#123;time_starttransfer&#125;\n time_total=%&#123;time_total&#125;\n&#x27;</span> -o /dev/null -s <span class="string">&#x27;http://www.baidu.com/&#x27;</span></span><br><span class="line"></span><br><span class="line">time_namelookup=0.008784        <span class="comment"># 从请求开始到域名解析完成的耗时</span></span><br><span class="line">time_connect=0.018379           <span class="comment"># 从请求开始到 TCP 三次握手完成耗时</span></span><br><span class="line">time_appconnect=0.079160        <span class="comment"># 从请求开始到 TLS 握手完成的耗时</span></span><br><span class="line">time_redirect=0.000000          <span class="comment"># 重定向时间，包括到内容传输前的重定向的 DNS 解析、TCP 连接、内容传输等时间</span></span><br><span class="line">time_pretransfer=0.079196       <span class="comment"># 从请求开始到向服务器发送第一个 GET/POST 请求开始之前的耗时</span></span><br><span class="line">time_starttransfer=0.137547     <span class="comment"># 从请求开始到内容传输前的时间</span></span><br><span class="line">time_total=0.137613             <span class="comment"># 从请求开始到完成的总耗时</span></span><br><span class="line"></span><br><span class="line">域名解析耗时 = time_namelookup                       </span><br><span class="line"><span class="comment"># 域名 NS 及本地 LocalDNS 解析耗时</span></span><br><span class="line"></span><br><span class="line">TCP 握手耗时 = time_connect - time_namelookup          </span><br><span class="line"><span class="comment"># 建立 TCP 连接时间</span></span><br><span class="line"></span><br><span class="line">SSL 耗时 = time_appconnect - time_connect              </span><br><span class="line"><span class="comment"># TLS 握手以及加解密处理</span></span><br><span class="line"></span><br><span class="line">服务器处理请求耗时 = time_starttransfer - time_pretransfer        </span><br><span class="line"><span class="comment"># 服务器响应第一个字节到全部传输完成耗时</span></span><br><span class="line"></span><br><span class="line">TTFB = time_starttransfer - time_appconnect            </span><br><span class="line"><span class="comment"># 服务器从接收请求到开始到收到第一个字节的耗时</span></span><br></pre></td></tr></table></figure>
<h3 id="Linux-启动过程"><a href="#Linux-启动过程" class="headerlink" title="Linux 启动过程"></a>Linux 启动过程</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_67794241/article/details/144076667">https://blog.csdn.net/m0_67794241/article/details/144076667</a></p>
<h3 id="Ssh-相关"><a href="#Ssh-相关" class="headerlink" title="Ssh 相关"></a>Ssh 相关</h3><h4 id="Home-目录下的-config"><a href="#Home-目录下的-config" class="headerlink" title="Home 目录下的 config"></a>Home 目录下的 config</h4><p>​    这个配置文件是用于简化 ssh  命令以及配置多 ssh 连接管理的</p>
<p>​    例如，配置个人和公司不同代码仓库的 ssh 认证信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  .ssh$ <span class="built_in">cat</span> config</span><br><span class="line">Host gogs.com</span><br><span class="line">    HostName 192.168.56.11</span><br><span class="line">    Port 10022</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile /home/fw/.ssh/id_ed25519</span><br><span class="line"></span><br><span class="line">Host gitlab.com</span><br><span class="line">    HostName git.dev.sh.ctripcorp.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile /home/fw/.ssh/id_rsa</span><br><span class="line">    </span><br><span class="line">➜  .ssh$ ssh -T git@gogs.com</span><br><span class="line">Hi there, You<span class="string">&#x27;ve successfully authenticated, but Gogs does not provide shell access.</span></span><br><span class="line"><span class="string">If this is unexpected, please log in with password and setup Gogs under another user.</span></span><br><span class="line"><span class="string">➜  .ssh</span></span><br><span class="line"><span class="string">➜  .ssh ssh -T git@git.dev.sh.ctripcorp.com</span></span><br><span class="line"><span class="string">Welcome to GitLab, @xxx!</span></span><br></pre></td></tr></table></figure>
<p>​    还有最常用的就是，公司内多环境的跳板机登录配置，配置后就可以用简化的命令 <code>ssh uat</code> 或 <code>ssh prod</code> 来访问跳板机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Host uat</span><br><span class="line">  ControlMaster auto</span><br><span class="line">  ControlPath ~/.ssh/master-%r@%h:%p</span><br><span class="line">  ControlPersist <span class="built_in">yes</span></span><br><span class="line">  User fw</span><br><span class="line">  HostName ssh.fws.jumpserver.sys.ctripcorp.com</span><br><span class="line"></span><br><span class="line">Host prod</span><br><span class="line">  ControlMaster auto</span><br><span class="line">  ControlPath ~/.ssh/master-%r@%h:%p</span><br><span class="line">  ControlPersist <span class="built_in">yes</span></span><br><span class="line">  User fw</span><br><span class="line">  HostName ssh.jumpserver.sys.ctripcorp.com</span><br></pre></td></tr></table></figure>
<h4 id="通过私钥生成公钥"><a href="#通过私钥生成公钥" class="headerlink" title="通过私钥生成公钥"></a>通过私钥生成公钥</h4><p>​    如果没有公钥文件，可以用该命令去生成公钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -y -f id_rsa &gt; id_rsa.pub</span><br></pre></td></tr></table></figure>
<h4 id="Ssh-远程连接错误"><a href="#Ssh-远程连接错误" class="headerlink" title="Ssh 远程连接错误"></a>Ssh 远程连接错误</h4><ol>
<li>验证失败，报错信息类似如下：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class="line">It is also possible that the RSA host key has just been changed.</span><br><span class="line">The fingerprint <span class="keyword">for</span> the RSA key sent by the remote host is</span><br><span class="line">ae:6e:68:4c:97:a6:91:81:11:38:8d:64:ff:92:13:50.Please contact your system administrator.</span><br><span class="line">Add correct host key <span class="keyword">in</span> /root/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending key <span class="keyword">in</span> /root/.ssh/known_hosts:70RSA host key <span class="keyword">for</span> x.x.x.x has changed and you have requested strict checking.</span><br><span class="line">Host key verification failed.</span><br></pre></td></tr></table></figure>
<p>​    该 ECS 实例可能进行过重装系统、账户信息变更等操作，导致 ECS 实例 SSH 公钥变更，造成本地客户端保存的公钥指纹与服务器端不一致，出现该提示信息</p>
<p>​    解决方法：<code>vim ~/.ssh/known_hosts</code> 这个文件，找到要远程登录的机器 ip，然后删除并保存，再重新使用 ssh 连接</p>
<ol>
<li>如果远程机器公钥配置正确，但是 ssh 连接报错 <code>Permission denied</code> 例如：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This is a private network server, <span class="keyword">in</span> monitoring state.</span><br><span class="line">It is strictly prohibited to unauthorized access and used.</span><br><span class="line">cdosapi@10.25.226.208: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span><br></pre></td></tr></table></figure>
<p><strong>SSH 对公钥、私钥的权限和所有权的要求是非常严格的</strong>，总结如下：</p>
<ul>
<li>下面两个目录的所有权必须是 user，所属组也应该是 user，前者权限不能是 777，后者权限必须为 700<ul>
<li>\home\user</li>
<li>\home\user.ssh</li>
</ul>
</li>
<li>公钥文件的所有权必须是 user，所属组也应该是 user，权限必须是 644<ul>
<li>\home\user.ssh\authorized_keys</li>
</ul>
</li>
<li>私钥文件的所有权必须是 user，所属组也应该是 user，权限必须是 600<ul>
<li>\home\user.ssh\id_rsa</li>
</ul>
</li>
</ul>
<ol>
<li>通过 -v 参数可以查看 ssh 连接过程中的日志信息</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -v user@hostname      <span class="comment"># 基础详细模式</span></span><br><span class="line">ssh -vv user@hostname     <span class="comment"># 更详细（二级）</span></span><br><span class="line">ssh -vvv user@hostname    <span class="comment"># 最高详细度（三级）</span></span><br></pre></td></tr></table></figure>
<ol>
<li>其他一些 ssh 连接问题参考：<ol>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/ecs/user-guide/ssh-remote-connection-problems/?spm=a2c4g.11186623.0.0.442f3efejiSLus">https://help.aliyun.com/zh/ecs/user-guide/ssh-remote-connection-problems/?spm=a2c4g.11186623.0.0.442f3efejiSLus</a></li>
</ol>
</li>
</ol>
<h3 id="故障排查思路"><a href="#故障排查思路" class="headerlink" title="故障排查思路"></a>故障排查思路</h3><p>​    一般 linux 故障可以分为：硬件相关，系统相关，服务与应用相关</p>
<p>​    常见的硬件故障，例如内存故障，磁盘损坏，风扇故障，驱动或设备故障等。系统故障一般都是资源耗尽，短时间大量进程运行等导致。应用服务问题，一般会和服务配置或参数不正确，代码层面有 bug 导致内存泄露等</p>
<p>​    <strong>一般的故障排查定位思路：</strong></p>
<ul>
<li>信息收集：<ul>
<li>可用 top，htop 等命令查看系统当前资源情况，以及什么进程在大量消耗资源</li>
<li>可用 dmesg，journalctl 命令去查看过滤系统日志</li>
<li>可用 netstat 等命令查看网络连接，端口等信息</li>
<li>通常上述的基本指标信息，可以通过监控看板能够快速查看异常出现的时间点或范围</li>
</ul>
</li>
<li>初步分析<ul>
<li>通过 uptime 可以查看到当前连接用户数，以及过去 1 分钟、5 分钟和 15 分钟的平均负载。根据 top 也可以查看到 cpu 和 memory 资源的使用率，判断是否机器资源不足。iostat -d -x 命令可以查看磁盘 I/O 的详细信息，包括磁盘的读写速度、等待时间等，如果磁盘 I/O 等待时间过长，说明可能存在磁盘瓶颈</li>
<li>通过 ps -ef 可以查看所有进程，判断是否有异常进程导致资源占用，lsof 查看某个进程打开的文件和网络连接，进一步分析进程的行为</li>
<li>通过 ping 检查网络连通性，traceroute 命令可以追踪数据包在网络中的传输路径，查看数据包在哪个节点出现延迟或丢失，从而定位网络故障的位置</li>
</ul>
</li>
</ul>
<p>​    更多参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/mDQrKMw1HdyX2EtRySpCGg">https://mp.weixin.qq.com/s/mDQrKMw1HdyX2EtRySpCGg</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Legacy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2133446919/">http://example.com/2133446919/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank"></a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a></div><div class="post_share"><div class="social-share" data-image="https://wei-foun.github.io/img/cover46.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/466764255/"><img class="prev-cover" src="https://wei-foun.github.io/img/cover47.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">airflow整理</div></div></a></div><div class="next-post pull-right"><a href="/4209932858/"><img class="next-cover" src="https://wei-foun.github.io/img/cover44.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">docker 容器网络</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2554484522/" title="LVS"><img class="cover" src="https://wei-foun.github.io/img/cover52.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-23</div><div class="title">LVS</div></div></a></div><div><a href="/3739994726/" title="虚拟化"><img class="cover" src="https://wei-foun.github.io/img/cover53.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-23</div><div class="title">虚拟化</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Legacy</div><div class="author-info__description">冒险的生涯在召唤！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">55</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Live a life you will remember</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">系统目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Terminal"><span class="toc-number">2.</span> <span class="toc-text">Terminal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">包管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">系统相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">系统内核参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%8F%AF%E4%BC%98%E5%8C%96%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0"><span class="toc-number">4.1.1.</span> <span class="toc-text">常见的可优化内核参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97"><span class="toc-number">4.2.</span> <span class="toc-text">系统日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Iptabels"><span class="toc-number">5.</span> <span class="toc-text">Iptabels</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E8%A1%A8%E4%BA%94%E9%93%BE"><span class="toc-number">5.1.</span> <span class="toc-text">四表五链</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nftables"><span class="toc-number">6.</span> <span class="toc-text">Nftables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#I-O-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">7.</span> <span class="toc-text">I&#x2F;O 重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E4%B8%8E%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">8.</span> <span class="toc-text">磁盘与文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.1.</span> <span class="toc-text">磁盘分区类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.2.</span> <span class="toc-text">文件系统类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Inode"><span class="toc-number">8.3.</span> <span class="toc-text">Inode</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAID"><span class="toc-number">9.</span> <span class="toc-text">RAID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LVM%EF%BC%88logical-volume-manager%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">LVM（logical volume manager）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1"><span class="toc-number">11.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shell"><span class="toc-number">12.</span> <span class="toc-text">Shell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">12.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">12.2.</span> <span class="toc-text">环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">12.3.</span> <span class="toc-text">位置变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%94%AF"><span class="toc-number">12.4.</span> <span class="toc-text">分支</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF"><span class="toc-number">12.5.</span> <span class="toc-text">循环</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86"><span class="toc-number">13.</span> <span class="toc-text">字符串处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E8%BF%9B%E8%A1%8C%E6%9B%BF%E6%8D%A2"><span class="toc-number">13.1.</span> <span class="toc-text">正则匹配文件内容进行替换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86-grep-sed-awk"><span class="toc-number">14.</span> <span class="toc-text">文本处理 grep | sed | awk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base64-%E7%BC%96%E8%A7%A3%E7%A0%81"><span class="toc-number">15.</span> <span class="toc-text">base64 编解码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Repo-%E5%8F%98%E9%87%8F%E6%9F%A5%E7%9C%8B"><span class="toc-number">16.</span> <span class="toc-text">Repo 变量查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%8B%E6%B5%8B"><span class="toc-number">17.</span> <span class="toc-text">web 服务器压测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-curl-%E6%9F%A5%E7%9C%8B%E8%AF%B7%E6%B1%82%E5%90%84%E9%98%B6%E6%AE%B5%E8%80%97%E6%97%B6"><span class="toc-number">17.1.</span> <span class="toc-text">通过 curl 查看请求各阶段耗时</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">18.</span> <span class="toc-text">Linux 启动过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ssh-%E7%9B%B8%E5%85%B3"><span class="toc-number">19.</span> <span class="toc-text">Ssh 相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Home-%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84-config"><span class="toc-number">19.1.</span> <span class="toc-text">Home 目录下的 config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%A7%81%E9%92%A5%E7%94%9F%E6%88%90%E5%85%AC%E9%92%A5"><span class="toc-number">19.2.</span> <span class="toc-text">通过私钥生成公钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ssh-%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E9%94%99%E8%AF%AF"><span class="toc-number">19.3.</span> <span class="toc-text">Ssh 远程连接错误</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E6%80%9D%E8%B7%AF"><span class="toc-number">20.</span> <span class="toc-text">故障排查思路</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/3930090917/" title="mysql-主备"><img src="https://wei-foun.github.io/img/cover55.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mysql-主备"/></a><div class="content"><a class="title" href="/3930090917/" title="mysql-主备">mysql-主备</a><time datetime="2025-08-24T13:50:40.000Z" title="发表于 2025-08-24 21:50:40">2025-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2733267950/" title="redis-分布式锁"><img src="https://wei-foun.github.io/img/cover54.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="redis-分布式锁"/></a><div class="content"><a class="title" href="/2733267950/" title="redis-分布式锁">redis-分布式锁</a><time datetime="2025-08-24T08:14:44.000Z" title="发表于 2025-08-24 16:14:44">2025-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/3739994726/" title="虚拟化"><img src="https://wei-foun.github.io/img/cover53.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟化"/></a><div class="content"><a class="title" href="/3739994726/" title="虚拟化">虚拟化</a><time datetime="2025-08-23T10:43:26.000Z" title="发表于 2025-08-23 18:43:26">2025-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2554484522/" title="LVS"><img src="https://wei-foun.github.io/img/cover52.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LVS"/></a><div class="content"><a class="title" href="/2554484522/" title="LVS">LVS</a><time datetime="2025-08-23T10:13:00.000Z" title="发表于 2025-08-23 18:13:00">2025-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/166210836/" title="gitlab-ci"><img src="https://wei-foun.github.io/img/cover51.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="gitlab-ci"/></a><div class="content"><a class="title" href="/166210836/" title="gitlab-ci">gitlab-ci</a><time datetime="2025-08-05T02:52:42.000Z" title="发表于 2025-08-05 10:52:42">2025-08-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://wei-foun.github.io/img/cover46.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Legacy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'MHzSjOElX9Cf5IJAfoNr4COL-gzGzoHsz',
      appKey: 'K3d5HK6zRMD2BINwstEANt7H',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_親親":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再見":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_發怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_發財":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可愛":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_嘔吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_壞笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尷尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_驚嚇":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>