<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Django 整理 | </title><meta name="keywords" content="Django"><meta name="author" content="Legacy"><meta name="copyright" content="Legacy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MVC 和 MTV 架构MVC​    MVC 模型是 web 服务器开发领域里著名的一个模型，所谓的 MVC 就是把 web 应用分为，模型（Model），控制器（Controller），视图（View），三者之间以一种 插件式 的，松耦合 的方式连接在一起 ​    模型 M：负责业务对象与数据库的映射关系（ORM） ​    视图 V：提供与用户进行交互的页面 ​    控制器 C：接收用户">
<meta property="og:type" content="article">
<meta property="og:title" content="Django 整理">
<meta property="og:url" content="http://example.com/2197405715/index.html">
<meta property="og:site_name">
<meta property="og:description" content="MVC 和 MTV 架构MVC​    MVC 模型是 web 服务器开发领域里著名的一个模型，所谓的 MVC 就是把 web 应用分为，模型（Model），控制器（Controller），视图（View），三者之间以一种 插件式 的，松耦合 的方式连接在一起 ​    模型 M：负责业务对象与数据库的映射关系（ORM） ​    视图 V：提供与用户进行交互的页面 ​    控制器 C：接收用户">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wei-foun.github.io/img/cover17.jpg">
<meta property="article:published_time" content="2020-07-13T08:28:12.000Z">
<meta property="article:modified_time" content="2025-04-01T17:58:07.134Z">
<meta property="article:author" content="Legacy">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wei-foun.github.io/img/cover17.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2197405715/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Django 整理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-02 01:58:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">30</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 爱好收集</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://wei-foun.github.io/img/cover17.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/"></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 爱好收集</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django 整理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-07-13T08:28:12.000Z" title="发表于 2020-07-13 16:28:12">2020-07-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-01T17:58:07.134Z" title="更新于 2025-04-02 01:58:07">2025-04-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python-web%E6%A1%86%E6%9E%B6/">python web框架</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python-web%E6%A1%86%E6%9E%B6/Django/">Django</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Django 整理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="MVC-和-MTV-架构"><a href="#MVC-和-MTV-架构" class="headerlink" title="MVC 和 MTV 架构"></a>MVC 和 MTV 架构</h3><h4 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h4><p>​    MVC 模型是 web 服务器开发领域里著名的一个模型，所谓的 MVC 就是把 web 应用分为，<strong>模型（Model），控制器（Controller），视图（View）</strong>，三者之间以一种 <strong>插件式</strong> 的，<strong>松耦合</strong> 的方式连接在一起</p>
<p>​    <strong>模型 M：</strong>负责业务对象与数据库的映射关系（ORM）</p>
<p>​    <strong>视图 V：</strong>提供与用户进行交互的页面</p>
<p>​    <strong>控制器 C：</strong>接收用户的输入调用模型和视图完成用户请求</p>
<p><img src="https://wei-foun.github.io/img/MVC.jpg" alt="img/md5.jpg"></p>
<h4 id="MTV"><a href="#MTV" class="headerlink" title="MTV"></a>MTV</h4><p>​    Django 用的是 MTV 模型，但是本质上是和 MVC 一样的，也是为了将各组件之间保持松耦合关系，但是定义上有些不同；依然是分为三块：<strong>模型（model），模板（template），视图（view）</strong> </p>
<p>​    <strong>模型 M：</strong>与 MVC 一样是负责业务对象和数据的关系映射，对数据库进行调取和处理，即数据存取层</p>
<p>​    <strong>模板 T：</strong>利用模板语法进行html和数据的渲染展示，即表现层</p>
<p>​    <strong>视图 V：</strong>负责业务的逻辑，并在适当时调用 model 和 template，即业务逻辑层</p>
<p>​    除了这三层之外，还有一个 <strong>Controller</strong> 即 <strong>URL分发器</strong>，作用是将一个个 url 的页面请求分发给匹配路由的视图来处理</p>
<p><img src="https://wei-foun.github.io/img/MTV.jpg" alt="img/md5.jpg"></p>
<h3 id="WSGI-和-uWSGI"><a href="#WSGI-和-uWSGI" class="headerlink" title="WSGI 和 uWSGI"></a>WSGI 和 uWSGI</h3><p>​    <strong>WSGI：</strong>web service getaway interface，<strong>web服务器网关接口</strong>，是一个 web服务器 与 应用服务器 通信的 <strong>一种规范协议</strong>，<strong>WSGI 是 web服务器 与 web应用程序 或 应用框架 之间的一种的接口</strong></p>
<p>​    <strong>uWSGI：</strong>是一个 <strong>web服务器</strong>，实现了 <strong>WSGI，uwsgi，http 协议</strong></p>
<p>​    <strong>uwsgi：</strong>它与 WSGI 一样，是 uWSGI服务器 的 <strong>通信协议</strong></p>
<p><img src="https://wei-foun.github.io/img/WSGI.jpg" alt="img/md5.jpg"> </p>
<p>​    对于 Python 的 Django 和 Flask 框架，他们本身就是基于 WSGI 实现的，但实际项目部署时，如果使用框架自身的 WSGI 来运行，性能上是非常有影响的，所以通常在生产环境下，会利用 uwsgi 或是 gunicorn 这类实现了 WSGI 的库来运行项目，后者性能更好，更轻量化</p>
<h3 id="Django-请求生命周期"><a href="#Django-请求生命周期" class="headerlink" title="Django 请求生命周期"></a>Django 请求生命周期</h3><p>​    1）按照 wsgi 协议，封装请求后交给 Django 框架</p>
<p>​    2）请求到达中间件，并对请求进行校验或是在请求对象中添加其他的相关数据，例如：csrf，request.session</p>
<p>​    3）通过中间件后，由路由控制器对请求 url 进行匹配，然后分发给对应的视图函数</p>
<p>​    4）视图函数进行业务逻辑的处理并返回</p>
<p>​    5）返回的需要再次经过中间件，对要响应的数据进行处理</p>
<p>​    6）通过 wsgi 再将响应结果和内容发送给浏览器</p>
<h3 id="Django-基本命令"><a href="#Django-基本命令" class="headerlink" title="Django 基本命令"></a>Django 基本命令</h3><p>​    <strong>安装：</strong><code>pip3 install django</code>， 直接安装会从原地址去下载，会非常非常慢甚至会中断失败，所以可以通过国内的一些镜像源去安装，比如豆瓣源：<code>pip3 install -i https://pypi.douban.com/simple/ django</code></p>
<p>​    <strong>创建 django 项目：<code>django-admin.py startproject 项目名称</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">项目名称文件夹</span><br><span class="line">|---- manage.py             # 启动文件 </span><br><span class="line">|---- 项目文件夹</span><br><span class="line">    |---- __init__.py</span><br><span class="line">    |---- settings.py       # 包含一些数据库等配置信息</span><br><span class="line">    |---- urls.py           # 全局路由与视图函数映射文件，但并不需要将所有 url 全写在这个文件中 </span><br><span class="line">    |---- wsgi.py           # 关于 wsgi 协议的配置设置</span><br></pre></td></tr></table></figure>
<p>​    <strong>创建应用：<code>python3 manage.py startapp 应用名称</code></strong>，该命令会在项目文件夹下创建一个应用的文件夹</p>
<p>​    <strong>注意，创建一个应用后，需要在 settings 文件中 INSTALLED_APPS 中，将引用添加进去，否则后面应用建好 ORM 模型类后，要进行数据迁移操作，就不会生成迁移文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">应用文件夹</span><br><span class="line">|---- __init__.py</span><br><span class="line">|---- admin.py</span><br><span class="line">|---- apps.py</span><br><span class="line">|---- migrations              # 进行迁移时，会产生文件在该文件夹下</span><br><span class="line">    |---- __init__.py</span><br><span class="line">|---- models.py</span><br><span class="line">|---- test.py</span><br><span class="line">|---- views.py</span><br></pre></td></tr></table></figure>
<p>​    <strong>启动项目：<code>python3 manage.py runserver (ip:port)</code></strong>，括号中的 ip 和端口可以不用显式输入，默认会在本地的 8000 端口启动这个项目，然后在浏览器输入 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> 就可以访问了，会跳转到 django 自带一个首页界面，会显示成功启动项目以及 django 的版本信息</p>
<p>​    <strong>模型创建和数据库同步：<code>python3 manage.py makemigrations</code></strong>，创建迁移记录文件，即将模型（models）文件中对数据库的操作，以文件形式进行记录，该命令执行后，会在 migrations 文件夹下生成一个 <code>0001_initial.py</code> 的文件，可以查看这个文件会发现其实和在 models.py 中的代码是相似的，只是做了一些处理且每一次创建迁移都会生成一个类似 <code>0001_initial.py</code>  的文件，需要知道的是 ‘makemigrations’ 的命令完成后，并不会影响到数据库</p>
<p>​    <strong><code>python3 manage.py migrate</code></strong>，即使数据库与 models.py 中的 <strong>模型集 和 迁移文件 进行同步，这个命令会直接对数据库进行操作</strong>，所以 ‘migrate’ 命令必然是在 ‘makemigrations’ 之后进行操作的</p>
<p>​    如果需要使用 django 自带的 admin 系统，需要通过命令注册账户，再次之前需要先进行一次迁移同步操作 migrate。然后在终端上输入 <code>python3 manage.py creatersuperuser</code>，按照要求顺序输入用户名，邮箱地址（可为空），密码有长度限制，但是回车后输入 y 依然可以创建。完成创建后，在 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a> 的地址就可以进行登录了</p>
<p>​    补充一点，如果想在 admin 系统里看见其他的 model，默认情况下只会有 Groups 和 Users 两个模型，自定义的模型要在 admin 页面中显示，需要在项目应用的目录中 admin.py 文件里将 models.py 的自定义的模型进行注册</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Jobs</span><br><span class="line"></span><br><span class="line">admin.site.register(</span><br><span class="line">    Jobs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="Django-配置文件"><a href="#Django-配置文件" class="headerlink" title="Django 配置文件"></a>Django 配置文件</h3><p>​    创建完一个 django 的应用后，在项目同名的子文件夹中，会自动生成一个 settings.py 的文件，其中包含了默认生成的一些配置项，注意！django 的 settings 的文件并不只是这一个，<strong>django 内部还有一个 settings 文件叫 global_settings 在 django 的 conf 下</strong>，global_settings.py 是整个 django 框架全局的配置文件，包含了所有的配置项和默认值，项目文件夹下的 settings.py 文件的作用是更改默认配置项的值，因为 django 的配置加载是优先加载 global_settings.py 中的配置，然后加载指定的 settings 文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line"><span class="comment"># __file__ 表示为当前 settings.py 文件，BASE_DIR 指的就是当前整个项目的根目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SECURITY WARNING: keep the secret key used in production secret!</span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;n%qi)e!np)*iu=hvt22w15pk0w115aw)%$*a=al@*87x16s8nq&#x27;</span></span><br><span class="line"><span class="comment"># secret_key 的值用作 session 的信息做加盐编码，注意提示说明了这个配置项在生产环境中要保留，对于 secret_key 的配置可以额外使用一个 env 文件保存 key，让关键信息和配置项隔离</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SECURITY WARNING: don&#x27;t run with debug turned on in production!</span></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"><span class="comment"># debug 配置项的作用是为了方便开发环境中对项目做调试，可以在页面上显示错误信息，默认是 True 开启调试的，在实际的生产环境中，需要将这个值改为 False</span></span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&quot;*&quot;</span>]</span><br><span class="line"><span class="comment"># allowed_host 用来配置可以访问网站的源，默认是元素是 * 表示允许任何源来访问，如果项目是允许固定的 ip 来访问，可以将指定的 ip 加入到列表里</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Application definition</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework.authtoken&#x27;</span>,  <span class="comment"># drf 的 token 认证</span></span><br><span class="line">    <span class="string">&#x27;course&#x27;</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># installed_apps 中包含了 django 自带的应用组件，开发中创建了应用后，需在将创建的应用添加到这个列表中，比如上面使用的第三方库 rest_framework，以及自己创建的 course 的应用</span></span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,   <span class="comment"># 对 request 的 user 赋值</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># middleware 同样包含 django 自带的处理中间件，包括 csrf 校验的 csrfmiddleware，自带的用户认证的 authenticationmiddleware，对 session 做处理的 sessionmiddleware</span></span><br><span class="line"><span class="comment"># ！！注意，任何自己创建的自定义的中间件，都只能加在 middleware 列表的最后，让 django 自带的中间件优先执行</span></span><br><span class="line"></span><br><span class="line">ROOT_URLCONF = <span class="string">&#x27;drf.urls&#x27;</span></span><br><span class="line"><span class="comment"># root_urlconf 配置指的值项目的总路由文件，即项目同名文件夹中的 urls.py，这个路由文件是所有应有路由的起始点</span></span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)]</span><br><span class="line">        ,</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># templates 的配置中，backend 包含了 django 使用模板引擎，dirs 指的是 django 的模板文件夹的路径，默认是在项目中的 templates 的文件夹</span></span><br><span class="line"></span><br><span class="line">WSGI_APPLICATION = <span class="string">&#x27;drf.wsgi.application&#x27;</span></span><br><span class="line"><span class="comment"># wsgi_application 配置的就是 django 的 wsgi 的应用，默认就是项目同名的文件夹中 wsgi.py 中的 application</span></span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: os.path.join(BASE_DIR, <span class="string">&#x27;db.sqlite3&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># databases 配置的就是项目使用的存储数据库，默认使用自带的 sqlite3 的数据库</span></span><br><span class="line"></span><br><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-hans&#x27;</span></span><br><span class="line"><span class="comment"># language_code 配置项表示使用的语言，改为 zh_hans 表示用中文，这样 django 自带的 admin 中可以用中文显示</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="comment"># time_zone 是时区的配置，改为使用 Asia/Shanghai，否则时区默认是 UTC </span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line"><span class="comment"># static_url 配置的是请求静态文件的资源，需要访问的路径</span></span><br><span class="line"></span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">&#x27;static&#x27;</span>)</span><br><span class="line"><span class="comment"># static_root 配置的是项目所有静态资源所要存放的目录，注意需要是一个绝对路径，当项目部署时，使用 python manage.py collectstatic 会将项目中所有的 static 的文件全部拷贝到当前的 static_root 的目录中</span></span><br><span class="line"></span><br><span class="line">STATICFILES_DIRS = (</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">&quot;staticfiles&quot;</span>),</span><br><span class="line">)</span><br><span class="line"><span class="comment"># staticfiles_dirs 配置并不完全是一个必须配置项，staticfiles_dirs 的作用是告诉 django 在查找静态资源的时候优先会在 staticfiles_dirs 中查找，如果资源存在就返回，没有就继续往后查找，到 static_root 去寻找</span></span><br></pre></td></tr></table></figure>
<h4 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h4><p>​    默认 django 的数据配置使用的 sqlite3，如果要是用 mysql，需要更改 engine 的配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line"> 	<span class="string">&#x27;default&#x27;</span>: &#123;  </span><br><span class="line">     <span class="comment"># default 表示默认使用的数据库</span></span><br><span class="line"> 		<span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line"> 		<span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;course&#x27;</span>,  <span class="comment"># 数据库名称 数据库需要自己提前建好</span></span><br><span class="line"> 		<span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,    <span class="comment"># 数据库用户名</span></span><br><span class="line">		<span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;&#x27;</span>,    <span class="comment"># 数据库密码</span></span><br><span class="line"> 		<span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;&#x27;</span>,        <span class="comment"># 数据库主机，留空默认为 localhost</span></span><br><span class="line"> 		<span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>,    <span class="comment"># 数据库端口</span></span><br><span class="line"> &#125;,</span><br><span class="line">    <span class="string">&#x27;db2&#x27;</span>: &#123;</span><br><span class="line">     <span class="comment"># 这里的 db2 表示的多数据库项目下的配置</span></span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;db_data&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;mysql_db&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;priv4te&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​    当项目如果是使用多数据库，比如要求 <strong>读写分离，那么就需要去配置 DATABASE_ROUTERS，来对指定数据库的读写分离的路由选择，django 中提供了两个方法来指定，分别是 db_for_read 和 db_for_write</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myrouter.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Router</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">db_for_read</span>(<span class="params">self, model, **hints</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;指定项目读取对象的数据库&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;db2&#x27;</span>     <span class="comment"># 分别是 DATABASES 数据库配置的名字</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">db_for_write</span>(<span class="params">self, model, **hints</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;指定项目写入模型类对象到的数据库&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;default&#x27;</span></span><br></pre></td></tr></table></figure>
<p>​    <strong>完成数据库的路由创建后，在 settings 中就可去指定 django 的数据路由配置 DATABASE_ROUTERS</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DATABASE_ROUTERS = [<span class="string">&#x27;myrouter.Router&#x27;</span>,]  <span class="comment"># 使用自己定义的数据库路由</span></span><br></pre></td></tr></table></figure>
<h4 id="缓存配置"><a href="#缓存配置" class="headerlink" title="缓存配置"></a>缓存配置</h4><p>​    django 默认生成的 settings 中是不配置缓存的配置，所以如果项目中使用到 redis 或其他缓存数据库，需要去配置 caches</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django 缓存配置</span></span><br><span class="line"> CACHES = &#123;</span><br><span class="line"> <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">  	<span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django_redis.cache.RedisCache&#x27;</span>,</span><br><span class="line">     <span class="comment"># backend 配置使用 django-redis 的 RedisCache，必设置项，这里使用 redis 来作为缓存中间件</span></span><br><span class="line">  	<span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;redis://127.0.0.1:6379&#x27;</span>,</span><br><span class="line">     <span class="comment"># location 是连接 redis 的地址和端口，必配置项</span></span><br><span class="line">  	<span class="string">&#x27;KEY_PREFIX&#x27;</span>: <span class="string">&#x27;alexham&#x27;</span>,</span><br><span class="line">     <span class="comment"># key-prefix 表示缓存时，key 的前缀，非必配置项</span></span><br><span class="line">  	<span class="string">&#x27;TIMEOUT&#x27;</span>: <span class="number">300</span></span><br><span class="line">     <span class="comment"># time-out 即 redis key 的超时时间，单位是秒，如果值为 None 表示不设置超时</span></span><br><span class="line">     <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">         <span class="comment"># options 的中用来配置三方可能需要的参数</span></span><br><span class="line">            <span class="string">&#x27;MAX_ENTRIES&#x27;</span>: <span class="number">1000</span></span><br><span class="line">         	<span class="comment"># max_entires 表示的缓存数，默认是 300，在 redis 的缓存配置中也为 非必配置项</span></span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="session-配置"><a href="#session-配置" class="headerlink" title="session 配置"></a>session 配置</h4><p>​    django 中 session 默认是存储在数据库中，数据迁移后生成一张 django_session 的表来存储，也支持其他的方式例如缓存方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session 相关配置</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.db&#x27;</span> </span><br><span class="line"><span class="comment"># .db 表示存储在数据库上（默认）</span></span><br><span class="line"><span class="comment"># .cache_db 表示存储在缓存数据库上</span></span><br><span class="line"><span class="comment"># .cache 表示直接放在缓存中</span></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_NAME ＝ <span class="string">&quot;sessionid&quot;</span></span><br><span class="line"><span class="comment"># session-cookie-name 表示在浏览器上 cookie 信息中的 key 的字段名字默认是 sessionid，也就是 sessionid=xxxxxxxxx</span></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_SECURE = <span class="literal">False</span></span><br><span class="line"><span class="comment"># session-cookie-secure 表示是否使用 https 传出 cookie，默认是 False</span></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_HTTPONLY = <span class="literal">True</span></span><br><span class="line"><span class="comment"># session-cookie-httponly 表示 session 的 cookie 只支持 http 协议传输</span></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_AGE = <span class="number">1209600</span></span><br><span class="line"><span class="comment"># session-cookie-age 表示 session 的 cookie 最大失效日期，默认是两周，即 60*60*24*7*2</span></span><br></pre></td></tr></table></figure>
<h4 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h4><p>​    日志的配置也是项目开发和测试时，必备的配置，补充一点 <strong>logging 日志的五个等级</strong>，按照从高到低顺序是：<strong>critical，error，warning，info，debug</strong>，还有一个最低级级别的 notest</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">LOG_DIR = os.path.join(BASE_DIR, <span class="string">&quot;logs&quot;</span>)</span><br><span class="line"></span><br><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="comment"># 默认配置项</span></span><br><span class="line">    <span class="string">&quot;disable_existing_loggers&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="comment"># 默认配置项</span></span><br><span class="line">    <span class="string">&quot;formatters&quot;</span>: &#123;</span><br><span class="line">        <span class="comment"># formatters 表示自定义日志格式</span></span><br><span class="line">        <span class="string">&quot;verbose&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;format&quot;</span>: <span class="string">&quot;%(levelname)s %(asctime)s %(module)s &quot;</span></span><br><span class="line">            <span class="string">&quot;%(process)d %(thread)d %(message)s&quot;</span></span><br><span class="line">            <span class="comment"># format 的值表示输出日志级别名称、日志信息，以及生成日志信息的时间、进程、线程和模块</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;handlers&quot;</span>: &#123;</span><br><span class="line">        <span class="comment"># handlers 中定义各类日志处理器</span></span><br><span class="line">        <span class="string">&quot;console&quot;</span>: &#123;</span><br><span class="line">            <span class="comment"># console 表示输出到终端</span></span><br><span class="line">            <span class="string">&quot;level&quot;</span>: <span class="string">&quot;DEBUG&quot;</span>,</span><br><span class="line">            <span class="comment"># level 表示的日志记录的等级，这里表示 DEBUG 以以上等级的日志信息全都写入日志</span></span><br><span class="line">            <span class="string">&quot;class&quot;</span>: <span class="string">&quot;logging.StreamHandler&quot;</span>,</span><br><span class="line">            <span class="string">&quot;formatter&quot;</span>: <span class="string">&quot;verbose&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;root&quot;</span>: &#123;<span class="string">&quot;level&quot;</span>: <span class="string">&quot;INFO&quot;</span>, <span class="string">&quot;handlers&quot;</span>: [<span class="string">&quot;console&quot;</span>]&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Django-中间件"><a href="#Django-中间件" class="headerlink" title="Django 中间件"></a>Django 中间件</h3><p>​    Django 中间件的使用是要在 settings 配置文件中的 Middleware 的配置项列表中去进行配置的，默认创建 Django 项目的时候，会加入一系列 Django 所要使用的中间件，包括 Sessionmiddleware，CsrfViewmiddleware，Authenticationmiddleware 等等</p>
<p>​    SessionMiddleware 的作用是开启对 session 会话支持，将信息存在 django_session 表里，以及对 request 的 session 做键值的设置和获取</p>
<p>​    CsrfViewMiddleware 的作用是为了防止跨站请求伪造，主要是对比提交的表单的 csrf_token 与 cookie 的 csrf_token 是否一致来判断请求是否可以执行</p>
<p>​    AuthenticationMiddleware 的作用是为了给 request 设置 user 属性，来判断请求是否是登录用户，以及匿名用户</p>
<p>​    httprequest 进入到 Django 中间件后，按照 settings 中 middleware 配置注册的顺序依次从上往下执行，当完成处理得到响应后，会从下而上再去执行一遍中间件，然后才能将 httpresponse 返回</p>
<p>​    <strong>Django 的中间件中提供了 5 个方法，包括：process_request，process_view，process_template_response，process_exception，process_response</strong>，其中常用的就是 process_request 和 process_response</p>
<p>​    首先，request 会进入到中间件的 process_request 方法，在这里可以对 request 做属性添加，或者属性值的判断。这方法 <strong>如果返回 None，就会将请求交给下一个中间件的 process_request 执行并以此类推，如果这里直接返回 response 对象，那么这个请求将不会走到路由匹配包括后面的视图中，而是直接给到最后一个中间的 process_response 去执行</strong></p>
<p>​    经过所有中间件的 process_request 之后，就会进入 url 文件进行路由匹配，完成后请求会回到第一个中间件，开始执行 <strong>process_view 方法，同理如果返回 None 就依次往后执行，返回 response 就会走到 process_response</strong></p>
<p>​    经过所有中间件的 process_view 之后，就会根据 url 对应的视图，把 request 交给视图开始做业务逻辑处理</p>
<p>​    如果在视图中，出现异常没有被捕获，那这个异常就会被 Django 去自行捕获，Django 会将捕获的异常再次执行中间件 process_exception，依然是从上往下执行，来得到异常的响应对象，然后再去执行 process_response</p>
<p>​    如果视图业务处理没有问题，最后使用 render 去通过模板渲染返回 response 的话，在 render 的选择模板的时候，会触发中间件的 process_template_response 方法 </p>
<p>​    最后，<strong>响应要返回都会经过中间件的 process_response 方法，而且执行的顺序是从下而上的</strong>，并且对于 process_response，必须要将返回一个 response</p>
<h3 id="URL-配置"><a href="#URL-配置" class="headerlink" title="URL 配置"></a>URL 配置</h3><p>​    在应用创建完成前，项目的目的下有一个全局的 urls.py ，即该文件所存储的就是网站中所有的 url 配置，不过通常来说，将应用的 url 放在全局的 urls 中显然有些不妥，不仅不方便对应查看，也不能体现根据应用实现 url 的解耦，所以都会在创建的应用文件夹中另外创建一个 urls.py 的文件，将该应用的 url 记录在该应用的 urls 中，且在全局 urls 文件中去引用它，这样全局的 urls 中只需要给一个对应创建应用的 url 就能指向到应用内部的创建的 urls 去匹配和分发，以此实现解耦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py 配置</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(正则表达式, views视图函数，参数，别名),   <span class="comment"># 在 django 1.1.x 的版本使用的 url 方法去配置理由，而在 2.2.x 的版本开始使用的是 path 和 re_path</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则表达式，即用来对 url 去进行匹配</span></span><br><span class="line"><span class="comment"># views 视图函数，即匹配成功后回调的 target，通常是一个视图函数名或是视图函数的路径</span></span><br><span class="line"><span class="comment"># 参数，可选的配置项，用来将这个默认参数传递给视图函数，是字典格式的</span></span><br><span class="line"><span class="comment"># 别名，可选的配置项，别名主要用来简化 url，方便在其他地方可以直接利用别名去找指定 url</span></span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># django 1.1.x，urls 配置</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url   <span class="comment"># 用 url 需要引入</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/$&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;^index/$&#x27;</span>, views.index), <span class="comment"># 普通路径</span></span><br><span class="line">    url(<span class="string">r&#x27;^articles/([0-9]&#123;4&#125;)/$&#x27;</span>, views.articles), <span class="comment"># 正则路径</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># django 2.2.x，urls 配置</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path    <span class="comment"># 用 re_path 需要引入</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),    <span class="comment"># admin 的路由是 django 自带的后台管理应用</span></span><br><span class="line">    path(<span class="string">&#x27;index/&#x27;</span>, views.index),   <span class="comment"># 普通路径</span></span><br><span class="line">    re_path(<span class="string">r&#x27;^articles/([0-9]&#123;4&#125;)/$&#x27;</span>, views.articles), <span class="comment"># 正则路径</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># path，用作普通路径，不需要手动添加正则的开始和结尾的限制符号</span></span><br><span class="line"><span class="comment"># re_path，和 1.1.x 中的 url 方法一致，需要手动去添加限制符（^ ，$）</span></span><br></pre></td></tr></table></figure>
<h4 id="url-的注意点"><a href="#url-的注意点" class="headerlink" title="url 的注意点"></a>url 的注意点</h4><p>​    1）url 的正则匹配由上至下逐一匹配，一旦有正则表达式满足 url 的匹配，就不会继续往后进行，所以在 url 的配置顺序上，如果有相似度极高的 url ，就需要做些配置顺序上的调整或是直接修改 url ，让每一个 url 可以被单独匹配，而不会在因为相似情况下，被前面的 url 匹配导致真正匹配的 url 不能匹配到，从而可能导致出错</p>
<p>​    2）url 的正则表达式前面不需要加上反斜杠 ‘/‘，因为浏览器会默认在 8080 后面加上 ‘/‘，发送请求后 url 是携带着这个反斜杠的</p>
<p>​    3）在使用 url 和 re_path 方法中设置正则表达式，建议在表达式字符串前加上 ‘r’，来表示一个原始字符串和防止转义</p>
<p>​    4）在 url 的正则匹配中，如果有参数，需要使用 ‘()’，例如   <code>re_path(r&#39;^articles/([0-9]&#123;4&#125;)/$&#39;, views.articles)</code>，匹配这个 url 的地址会携带后面 4 个数字，一旦 url 匹配上，这个 4 位数的参数会被一起传递给视图函数 articles，那么在这个函数中，就需要定义一个形参去接受这个参数</p>
<p>​    5）即明确名字的参数，例如   <code>path(&#39;articles/&lt;int:year&gt;/&lt;int:month&gt;/&#39;, views.month_archive),</code>，这个 url 中使用 ‘&lt;&gt;’ 明确定义了参数，那么在视图函数中 views.month_archive 的形参就需要明确定义 year 和 mouth</p>
<h4 id="无名分组和有名分组"><a href="#无名分组和有名分组" class="headerlink" title="无名分组和有名分组"></a>无名分组和有名分组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无名分组</span></span><br><span class="line"><span class="comment"># urls 中的配置</span></span><br><span class="line">url(<span class="string">r&#x27;^articles/(\d&#123;4&#125;)/(\d&#123;2&#125;)/$&#x27;</span>, views.year_month), </span><br><span class="line"></span><br><span class="line"><span class="comment"># views 的配置</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">year_month</span>(<span class="params">request, y, m</span>)</span><br><span class="line"></span><br><span class="line">此时，请求 url = <span class="string">&#x27;http://127.0.0.1:8000/articles/2020/05/&#x27;</span></span><br><span class="line">进入到视图处理时， 就是 year_month(requset,<span class="number">2020</span>,05)   <span class="comment"># 匹配的 url 会按位置传递参数</span></span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有名分组</span></span><br><span class="line"><span class="comment"># 应用的 urls.py </span></span><br><span class="line">url(<span class="string">r&#x27;^articles/(?P&lt;year&gt;\d&#123;4&#125;)/(?P&lt;month&gt;\d&#123;2&#125;)/$&#x27;</span>, views.year_month) </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">year_month</span>(<span class="params">request, year, month</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f&#x27;year:<span class="subst">&#123;year&#125;</span>, month:<span class="subst">&#123;month&#125;</span>&#x27;</span>)   <span class="comment"># HttpResponse 可以时间将指定的字符渲染到页面上</span></span><br></pre></td></tr></table></figure>
<p>​    此时，请求   <code>url = http://127.0.0.1:8000/articles/2020/05/</code>，进入到视图处理时， 就是 year_month(requset, year=2020, month=05)</p>
<p><img src="https://wei-foun.github.io/img/views1.jpg" alt="img/md5.jpg"> </p>
<h4 id="url-分发"><a href="#url-分发" class="headerlink" title="url 分发"></a>url 分发</h4><p>​    前面说到了，对于 urls 配置可以根据应用内部创建 urls.py 的文件去实现解耦，这就是 url 的分发，但是前提是需要在全局的 urls 中去配置要分发的路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">Including another URLconf</span><br><span class="line">    1. Import the include() function: from django.urls import include, path</span><br><span class="line">    2. Add a URL to urlpatterns:  path(&#x27;blog/&#x27;, include(&#x27;blog.urls&#x27;))</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>​    全局的 urls 文件中给出了这样的提示，所以只需要模仿它的样子，在全局中去导入 app 和 <code>from django.urls import include</code> 即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局的 urls 文件</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include</span><br><span class="line"><span class="keyword">import</span> app01</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(<span class="string">&#x27;app01.urls&#x27;</span>)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用 app01 的 urls 文件</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^articles/([0-9]&#123;4&#125;)/$&#x27;</span>, views.year_article),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>​    全局的 url 分发的正则部分给了空，也就是说当使用 python  manage.py 启动项目后，直接访问启动的路由，这个请求就会被分发到 app01 中的 urls 中，再去进行匹配得到对应处理的视图</p>
<h4 id="url-反向解析"><a href="#url-反向解析" class="headerlink" title="url 反向解析"></a>url 反向解析</h4><p>​    所谓反向解析，是为了在模板中为了渲染 url，但是直接将 urls 中路由填写在模板中显然是不合理的，所以在配置 url 时就有了参数 name，用别名来代替 url，可以更简便的管理 url</p>
<p>​    反向解析的目的就是防止对 url 进行硬编码，以至于在修改了 urls 中的路由后，不用 name 的情况下，就需要一个个去修改模板中的路由，否则就无法进行跳转，并且会在渲染时就会抛出异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 反向解析 url ，可以是在视图函数中或是在模板文件中</span></span><br><span class="line"><span class="comment"># 假设 urls 中有一个路由</span></span><br><span class="line">path(<span class="string">&#x27;news/index&#x27;</span>, views.index, name=<span class="string">&#x27;news_index&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 视图函数中的应用：</span></span><br><span class="line">reverse(<span class="string">&quot;news_index&quot;</span>)     <span class="comment"># 返回 http://127.0.0.1:8000/news/index</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果路由是一个需要动态参数的话，通过 args 添加</span></span><br><span class="line">reverse(<span class="string">&quot;news_index&quot;</span>, args=(<span class="number">1</span>,))     <span class="comment"># 返回 http://127.0.0.1:8000/news/index/1/</span></span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模板中的应用：</span></span><br><span class="line">&#123;% url <span class="string">&#x27;news_index&#x27;</span> %&#125;     <span class="comment"># 即 http://127.0.0.1:8000/news/index</span></span><br><span class="line"></span><br><span class="line">&#123;% url <span class="string">&#x27;news_index&#x27;</span> <span class="number">1</span> %&#125;   <span class="comment"># 即 http://127.0.0.1:8000/news/index/1/</span></span><br></pre></td></tr></table></figure>
<p>​    <strong>补充 reverse  和 reverse_lazy：</strong></p>
<p>​    在视图函数中，要想直接利用 url.py 中路由设置的 name 来做反向解析，除了 reverse 方法，还有一个 reverse_lazy 的方法。两者简单的区别是，<strong>reverse 方法适用于在 FBV 中做反向 url 解析，而 reverse_lazy 方法则是适用于 CBV 中来处理</strong></p>
<p>​    为什么 reverse 不能在 CBV 中使用，而 reverse_lazy 可以呢？官方文档的解释是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">It <span class="keyword">is</span> useful <span class="keyword">for</span> when you need to use a URL reversal before your project’s URLConf <span class="keyword">is</span> loaded.</span><br><span class="line"><span class="comment"># 就是说，如果在 django 的 urlconf 文件加载前就要使用 url 的方向解析，最好就是使用 reverse_lazy</span></span><br></pre></td></tr></table></figure>
<p>​    同时也给出适合使用的场景，其中第一个就是 CBV 的视图，然后使用装饰器的时候如果使用 url 反向解析，比如 login_url 的参数是反向 url，这些就需要使用 reverse_lazy 方法</p>
<p>​    详细来说，python 在导入一个模块时，会默认 “执行” 一次这个模块，这其中包括全局变量的定义和赋值，函数和类的声明，以及检查 <code>__name__</code> 的主线程代码的操作。对于类而言，类的全局属性也会被加载赋值，但是如果类的全局属性是一个函数的结果，那么这个函数也就需要被立即执行。所以对于 django 的 CBV 来说，全局属性使用 reverse 来方向解析 url 时，如果这个 url 不是全局 url.py 下的，而是跟随具体应用的话，即全局 url 是通过 include 导入的，那么 CBV 的方向解析 url 如果是其他的应用，这会因为加载顺序问题导致无法解析而抛出异常</p>
<p>​    而 reverse_lazy 就是 reverse 的惰性版本的方法，这个方法会等待 urlconf 全部加载完成后，再去方向解析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 具体例子</span></span><br><span class="line"><span class="comment"># importme.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;FUNCTION HELLO&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;CLASS HELLO&quot;</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> importme</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>CLASS HELLO</span><br></pre></td></tr></table></figure>
<p>​    可见模块导入后，CBV 的 print 方法会被立刻执行，这样一来在 django 的 CBV 中，如果 success_url 的属性值是通过 reverse 方法的时候，这个方法就会立刻执行，导致出现上诉说明的情况，所以可以使用 reverse_lazy 方法或是在 get_success_url 中调用 reverse</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewJobCBV</span>(LoginRequiredMixin, CreateView):</span><br><span class="line">    template_name = <span class="string">&#x27;company/job.html&#x27;</span></span><br><span class="line">    form_class = newJobForm</span><br><span class="line">    <span class="comment"># success_url = reverse_lazy(&#x27;newJob&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_success_url</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> reverse(<span class="string">&quot;newJob&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="url-名称空间"><a href="#url-名称空间" class="headerlink" title="url 名称空间"></a>url 名称空间</h4><p>​    即给应用的 url 划定唯一的空间，所以即使出现相同的 url 只要是在不同的应用名称空间中都是允许的，名称空间的定义是在配置 url 分发时，通过参数 namespace 来指定</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;xxxx/xxx&#x27;</span>,  include((<span class="string">&#x27;app.urls&#x27;</span>, <span class="string">&#x27;app&#x27;</span>), namespace=<span class="string">&#x27;app&#x27;</span>))</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 第一个 app 是应用名称，第二个 app 是 namespace 也就是名称空间</span></span><br></pre></td></tr></table></figure>
<h3 id="HttpRequests-和-HttpResponse-对象"><a href="#HttpRequests-和-HttpResponse-对象" class="headerlink" title="HttpRequests 和 HttpResponse 对象"></a>HttpRequests 和 HttpResponse 对象</h3><p>​    HttpRequests 即 访问的 http 请求，客户端向应用服务器发起请求来获取资源，HTTPResponse 即 http 响应，服务器接收到客户端的请求后将处理后的结果发回给客户端</p>
<h4 id="HttpRequests-对象"><a href="#HttpRequests-对象" class="headerlink" title="HttpRequests 对象"></a>HttpRequests 对象</h4><p>​    当服务器接收到请求后，django 会根据报文创建 HttpRequests 对象，并且会在内部封装一个 request 作为 HttpRequests 对象，而这个 request 就是视图函数中第一个必须的参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性</span></span><br><span class="line">path          <span class="comment"># 请求的路径，但是不包括域名和端口</span></span><br><span class="line">method        <span class="comment"># 请求的类型，以全大写返回，如 GET，POST</span></span><br><span class="line">GET           <span class="comment"># GET 请求中所有的参数，返回的是一个 QueryDict 对象</span></span><br><span class="line">POST          <span class="comment"># 同上，返回的是 POST 请求中的参数</span></span><br><span class="line">body          <span class="comment"># json 数据需要通过 body 获取，但返回结果不是字典，而是字节类型的字符串，所以需要先 decode</span></span><br><span class="line">COOKIES       <span class="comment"># 返回请求头中 Cookie 信息，字典形式返回</span></span><br><span class="line">FILES         <span class="comment"># 文件上传的 QueryDict 对象，key 是 input 标签中的 name，而 value 包含 filename(文件名)，content_type(文件 content_type 类型)，content(文件原始内容)</span></span><br><span class="line">session       <span class="comment"># 返回一个 session 对象，可以在 django 的中间件启用</span></span><br><span class="line">user          <span class="comment"># 即当前访问登录的用户对象，是一个 django.contrib.auth.models.User 对象，同样可以在中间件去启用</span></span><br><span class="line">META          <span class="comment"># 包含请求和响应的 headers 中所有的信息，是一个字典格式，且 key 全部都是大写，另外对比浏览器的头部信息，可以看到在请求的头部中，django 给键都加上了 HTTP_ 前缀，所以如果要去添加一个自定义的信息到 META 中，就需要加上必要的前缀</span></span><br><span class="line">	 CONTENT_LENGTH    <span class="comment"># 正文长度</span></span><br><span class="line">	 CONTENT_TYPE      <span class="comment"># 正文的 MIME 类型</span></span><br><span class="line">	 HTTP_ACCEPT       <span class="comment"># 可接受的 Content-Type</span></span><br><span class="line">	 HTTP_ACCEPT_ENCODING     <span class="comment"># 可接受的响应编码类型</span></span><br><span class="line">	 HTTP_HOST         <span class="comment"># 客户端发送的 host 头部</span></span><br><span class="line">	 HTTP_USER_AGENT   <span class="comment"># 客户端的 User-Agent 的字符串</span></span><br><span class="line">	 REMOTE_ADDR       <span class="comment"># 客户端的 ip 地址</span></span><br><span class="line">	 REMOTE_HOST       <span class="comment"># 客户端的主机名</span></span><br><span class="line">	 REQUEST_METHOD    <span class="comment"># 请求方法的字符串，&quot;GET&quot; 等等</span></span><br><span class="line">	 SERVER_NAME       <span class="comment"># 服务器的主机名</span></span><br><span class="line">	 SERVER_PORT       <span class="comment"># 服务器的端口字符串</span></span><br><span class="line">	 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法</span></span><br><span class="line">get_full_path()    <span class="comment"># 返回请求的 url，同样没有域名和端口，但是与 path 属性不同，该方法在请求有参数的情况下会返回带有参数的 url</span></span><br><span class="line">is_ajax()          <span class="comment"># 判断请求是否是 AJAX 发起的</span></span><br></pre></td></tr></table></figure>
<h4 id="HttpResponse-对象"><a href="#HttpResponse-对象" class="headerlink" title="HttpResponse 对象"></a>HttpResponse 对象</h4><p>​    请求的 httprequests 是由 django 来自动创建的，进入到视图函数处理完成后，就需要去返回，也就是需要去创建一个相应的 httpresponse 对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常用的方法</span></span><br><span class="line"></span><br><span class="line">render(request, template_name[, context]）</span><br><span class="line"><span class="comment"># 用于直接渲染模板文件或是给定的上下文字典加入到文件一同渲染，最后会返回一个 HttpResponse 对象，视图函数最后只需要 return 这个对象即可</span></span><br><span class="line"><span class="comment"># request，参数是必须的参数，用作响应的请求对象</span></span><br><span class="line"><span class="comment"># template_name，即要渲染的模板文件</span></span><br><span class="line"><span class="comment"># context，可选参数，且是字典结构，渲染文件时会将字典作为上下文传递给模板文件，让其进行渲染</span></span><br><span class="line"><span class="comment"># content_type，可选参数，指定生成的文档使用的 MIME 类型</span></span><br><span class="line"><span class="comment"># status，来指定响应的状态码</span></span><br><span class="line"></span><br><span class="line">redirect()</span><br><span class="line"><span class="comment"># 用于进行页面跳转</span></span><br><span class="line"></span><br><span class="line">HttpResponse()</span><br><span class="line"><span class="comment"># 可以直接将字符串传入，来作为页面内容构造响应对象，请求页面会将字符串显示；也可直接实例化这个响应对象，使用该对象的 write 方法将字符串写入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HttpResponse 对象举例：</span><br><span class="line">ret = HttpResponse(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">ret = render(request, <span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">ret = redircet(<span class="string">&quot;/index/&quot;</span>)    <span class="comment"># 这是写死的 url，跳转默认会将当前的域名和端口</span></span><br></pre></td></tr></table></figure>
<h3 id="FBV-和-CBV"><a href="#FBV-和-CBV" class="headerlink" title="FBV 和 CBV"></a>FBV 和 CBV</h3><p>​    FBV：function base views，基于函数的视图，即使用 def 去定义函数作为请求的处理入口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt   <span class="comment"># csrf_exempt装饰器，用来取消自带的 csrf 认证</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@csrf_exempt</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;login.html&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>​    CBV：class base views，基于类的视图，即使用面向对象的方式去定义视图，让类作为处理的入口，这样就可以利用类的三大特性，来实现高可用的代码，比如 Mixin 的多继承，并且不用像 FBV 中对于同一 url 的不同请求类型需要利用 if 去判断，使用 CBV 将每一个类型请求单独隔离开，这样维护成本就会降低</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator   <span class="comment"># method_decorator 用来给视图类做装饰</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">@method_decorators(<span class="params">csrf_exempt, name=<span class="string">&quot;dispatch&quot;</span></span>)  </span><span class="comment"># CVB 中取消 csrf，使用 method_decorator 的话，name 的参数必须是 dispatch，而不是 POST，因为 CBV 的请求处理，是先进入的 View 的 dispatch</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;GET&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># @csrf_exempt       # CVB 取消 csrf，也可以像 FBV 一样使用 csrf_exempt 来专门对 post 做装饰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;POST&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>​    使用 CBV 时，创建的类需要去继承 django.views 的 View，另外要注意，使用 CBV 去编写处理逻辑前，urls 的配置也需要改变，需要在类名后加上 <code>.as_view()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;index/&#x27;</span>, views.MyView.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"># 渲染变量语法：</span><br><span class="line"></span><br><span class="line">&#123;&#123; 变量名 &#125;&#125;</span><br><span class="line"></span><br><span class="line"># 变量的渲染必须是在 &#123;&#123; &#125;&#125; 之内，且如果变量是一个 list 或 dict 的话，想要渲染其中的某一个值，可以使用 .索引 或 .key 来遍历取出想要的值</span><br><span class="line"># 如果要渲染的这个变量是一个 object 的话，依然可以使用 .属性 或 .方法 获取值，但是 . 后面只能是无参的方法，如果要直接渲染对象，需要在对象内部实现 __str__ 方法</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># 渲染标签语法：</span><br><span class="line"></span><br><span class="line">&#123;% 标签名 %&#125;</span><br><span class="line"></span><br><span class="line"># 通常不会直接使用这样的方式去渲染出一个简单 html，一般对于标签渲染都会用于需要循环创建的逻辑，比如需要渲染一堆 li 标签等等</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># 用 for 循环创建标签</span><br><span class="line"></span><br><span class="line">&#123;% for i in [111,222,333] %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; i &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125; </span><br><span class="line"></span><br><span class="line"># for 循环创建标签并渲染，在最后需要使用 &#123;% endfor %&#125;，如果需要将遍历的序号一起渲染，需要使用 &#123;&#123; forloop.counter &#125;&#125;，这个语法会依次将遍历序号渲染，且是从 1 开始，如果要改为从 0 开始，使用 &#123;&#123; forloop.counter0 &#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% for name in name_list %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; name &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line">	&lt;p&gt; no, name! &lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125; </span><br><span class="line"></span><br><span class="line"># &#123;% empty %&#125; 的标签语法并会渲染任何标签，它会在 for 循环是空的，或是变量找不到的情况下触发，来保证如果使用 for 得不到任何东西时，可以渲染一些提示等等，让操作能完成</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># 条件判断语法:</span><br><span class="line"></span><br><span class="line">&#123;% if num &lt; 17 %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; num &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% elif num &gt; 5 %&#125;</span><br><span class="line">	&lt;p&gt;&#123;&#123; num + 1 &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">	&lt;p&gt;&#123;&#123; num - 10 &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"># 和 for 循环标签语法一样，使用 if 的条件判断最后一个需要使用 endif</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">表单提交的标签：</span><br><span class="line"></span><br><span class="line">&#123;% csrf_token %&#125;</span><br><span class="line"></span><br><span class="line"># 这是一个安全机制的标签，csrf 是指跨站请求伪造，跨站即跨域，csrf_token 的标签其实最后渲染后就是一个隐藏的 input 标签，csrf_token 标签不限位置，提交时会自动找到加上</span><br><span class="line"># 例如：&lt;input type=&quot;hidden&quot; name=&quot;csrfmiddlewaretoken&quot; value=&quot;uNHz6h6kVLlSXrMsyA7grL4Ly08D1ewY4kBtm9DnK3b6mC6cWUz8z5tIYCLvqQlw&quot;&gt;</span><br><span class="line"># django 的中间件 django.middleware.csrf.CsrfViewMiddleware 默认是开启，所以在提交发起请求后如果没有添加 csrf_token 的标签，会遇到 403 forbidden 的错误，在测试阶段也可以在 settings 文件的 MIDDLEWARE 中找到 &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27; 将其注释，表示不启用保护</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">with 标签：</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&#123;&#123; person_list.2.name &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% with name=person_list.2.name %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; name &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endwith %&#125;</span><br><span class="line"></span><br><span class="line"># with 标签相当于是给原本变量起了别名，因为变量可以利用 . 来实现一个链式的获取，就会导致可能需要写很长的一段代码，如果这个值恰好是常用的，就会相对繁琐一些，利用 with 别名去接收原来的值并使用要更加简便</span><br></pre></td></tr></table></figure>
<h4 id="模板语法自带的过滤器方法"><a href="#模板语法自带的过滤器方法" class="headerlink" title="模板语法自带的过滤器方法"></a>模板语法自带的过滤器方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 没有值或为空的替补值：default</span><br><span class="line">&#123;&#123;  res | default:val &#125;&#125;      # 如果 res 为 false 或 空，使用默认值 val</span><br><span class="line"></span><br><span class="line"># 返回变量的长度：length</span><br><span class="line">&#123;&#123; res | length &#125;&#125;             # 如果变量是一个列表，就返回列表的长度</span><br><span class="line"></span><br><span class="line"># 文件大小格式化：filesizeformat</span><br><span class="line">&#123;&#123; res | filesizeformat &#125;&#125;     # 将 res 转化为合适的存储大小单位，如：KB，MB，bytes...</span><br><span class="line"></span><br><span class="line"># 日期过滤：date</span><br><span class="line">&#123;&#123; res | date:&#x27;Y-m-d&#x27; &#125;&#125;     # res 是类似 datetime.datetime.now()，则会根据规定给定的 date 的字符串去格式化</span><br><span class="line"></span><br><span class="line"># 字符串切片过滤器：slice</span><br><span class="line">&#123;&#123; res | slice:&#x27;5:7&#x27;&#125;&#125;        # 将 res 根据给定范围去截取</span><br><span class="line"></span><br><span class="line"># 字符串截断：truncatechars</span><br><span class="line">&#123;&#123; res | truncatechars:num &#125;&#125;     # 会将 res 整体截取到给定的 nums 的位置，并将最后一个字符替换为 &#x27;...&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 单词截断：truncatewords</span><br><span class="line">&#123;&#123; res | truncatewords:num &#125;&#125;     # 同上，按照英文单词截断，每一位表示一个英文单词</span><br><span class="line"></span><br><span class="line"># 例如：s = &#x27;l am not throwing away my shot, hey yo, l just like my contry, young, scrape and hungry&#x27;</span><br><span class="line">使用 &#123;&#123;  res | truncatewords:5 &#125;&#125;，页面显示 &#x27;l am not throwing away …&#x27;</span><br><span class="line">使用 &#123;&#123;  res | truncatechars:15 &#125;&#125;，页面显示 &#x27;l am not throw…&#x27;</span><br><span class="line"></span><br><span class="line"># 防止转义</span><br><span class="line">&#123;&#123; res | safe &#125;&#125;             # 如果 res 是包含了 html 标签 或 是 js 代码 的内容需要使用 safe 过滤器防止显示异常，来告知 django 代码是安全的</span><br><span class="line"></span><br><span class="line"># 例如：res = &#x27;&lt;a href=&quot;&quot;&gt;点击&lt;/a&gt;&#x27;，直接交给模板渲染会将标签也一起作为字符串渲染，页面会显示 &lt;a href=&quot;&quot;&gt;点击&lt;/a&gt;，使用 &#123;&#123; res | safe &#125;&#125;，则会渲染 a 标签，页面会显示一个可以点击的 &#x27;点击&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="自定义标签与过滤器"><a href="#自定义标签与过滤器" class="headerlink" title="自定义标签与过滤器"></a>自定义标签与过滤器</h4><p>​    在去创建自定义的标签与过滤器之前，需要完成三个前置步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）在 settings 配置文件中找到 INSTALLED_APPS，并在这个列表中配置上创建的应用名</span><br><span class="line"></span><br><span class="line">2）在创建的应用中，新建一个文件夹作为包，且文件名必须为 &#x27;templatetags&#x27;</span><br><span class="line"></span><br><span class="line">3）在 &#x27;templatetags&#x27; 中创建任意名字的 py 文件，作为自定义标签和过滤器的模块</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># templates 中新建 my_tags.py </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> make_safe     <span class="comment"># make_safe 类似 safe 过滤器</span></span><br><span class="line"></span><br><span class="line">register = template.Library()      <span class="comment"># register 对象只能是这个名字</span></span><br></pre></td></tr></table></figure>
<p>​    <strong>自定义过滤器</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.filter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">power</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> x**y</span><br></pre></td></tr></table></figure>
<p>​    <strong>自定义标签</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.simple_tag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new_input</span>(<span class="params"><span class="built_in">id</span>, arg</span>):</span><br><span class="line">    content = <span class="string">f&quot;&lt;input type=&#x27;text&#x27; id=<span class="subst">&#123;<span class="built_in">id</span>&#125;</span> class=<span class="subst">&#123;arg&#125;</span> /&gt;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> mark_safe(content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment">#	使用前，也有一个前置步骤：在要是用自定义过滤器或标签的 html 模板中，使用  &#123;% load my_tags %&#125; 将创建的 my_tags 模块导入</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &#123;% load my_tags %&#125;</span><br><span class="line">    </span><br><span class="line">    &lt;h3&gt;&#123;&#123; num | power:6 &#125;&#125;&lt;/h3&gt;</span><br><span class="line">    &#123;% new_input &#x27;user&#x27; &#x27;red&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>​    最后，配合上视图的处理，返回的 html 如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>64<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>     <span class="comment">&lt;!-- 这里视图函数中传递的 num 的值是 2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​    <strong>区别：</strong></p>
<p>​    <strong>自定义过滤器</strong> 只能接受 <strong>两个参数</strong>，即定义函数时只能有两个形参，第一个参数为模板语法中 ‘|’ 管道符前的变量，第二个参数为自定义过滤器参数，就是管道符后过滤器名后的参数；且自定义过滤器是 <strong>可以配合 if 和 for</strong> 两个逻辑操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if num|power:6 &gt;= 60 %&#125;      &lt;!-- 这里的管道符左右是不能有空格的 --&gt;</span><br><span class="line">    &lt;h3&gt;&#123;&#123; num|power:6 &#125;&#125;&lt;/h3&gt;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    &lt;h3&gt;大于 60&lt;/h3&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<p>​    <strong>自定义标签</strong> 与自定义过滤器相反，<strong>不对参数的个数做限制</strong>，但同样也就 <strong>无法配合 if 和 for</strong> 来使用自定义标签</p>
<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>​    即对于使用相同部分的 html 的文件，可以利用继承来减少模板之前大量的相同地方，通过将需要的结构代码放在 base 之中，利用模板语法继承这个 base 就能实现一样的内容（包括 html 结构 或 css 的样式 或是 js 的代码）</p>
<p>​    <strong>创建继承：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1）可以选择创建一个 base.html，将可能多个模板都会用到的代码放在该文件中</span><br><span class="line"></span><br><span class="line">2）在需要使用到相同部分的 html 模板文件中，直接利用  &#123;% extends &#x27;base.html&#x27; %&#125;，就可以实现继承</span><br><span class="line"></span><br><span class="line">3) 这时，再去访问 index，会将 base 中的部分原封不动的搬过来，简单高效；但是，只有继承的话对于那些可能有用相同的部分，但是内容上却不同的不就又无法使用 extends 去继承了，例如相同样式的导航栏，会员与普通用户所看到的导航菜单是不一样的，这就需要使用 钩子 去实现一个可自定制的继承</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>​     <strong>钩子</strong> 的创建也很简单：</p>
<p>​    在 base 的模板文件中，使用 block 标签留出其他模板会添加的部分，或是将一块部分用 block 标签框起来，这样继承 base 的模板就可以实现在这一块的自定制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># base.html</span><br><span class="line">&#123;% block 钩子名 %&#125;</span><br><span class="line">	....</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://wei-foun.github.io/img/%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF.jpg" alt="img/md5.jpg"></p>
<p>​    上图中就是直接在 index 的 html 文件中继承使用 base 的 html 文档，当访问上 index 后就会看到 base 页面上原本就存在 dom</p>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>​    前端向后端上传文件，有两种方式：form 表单，或是 ajax 的 post 封装好文件数据上传</p>
<p>​    1）form 表单上传</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-md-12&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  前端使用 form 表单去上传文件，需要使用 enctype 属性，值为 multipart/form-data --&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">lable</span>&gt;</span>请输入姓名<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lable</span>&gt;</span>请选择上传文件<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">id</span>=<span class="string">&quot;files&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;upload_file.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        file_obj = request.FILES.get(<span class="string">&quot;files&quot;</span>)      <span class="comment"># 上传的文件对象 request.FILES</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_obj:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&quot;no files for upload&quot;</span>)</span><br><span class="line">        file_dir = os.path.join(settings.BASE_DIR, <span class="string">f&#x27;static/uploads/<span class="subst">&#123;file_obj.name&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_dir, <span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> file_obj.chunks():</span><br><span class="line">                f.write(chunk)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;ok&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>​    2）ajax 上传，<strong>注意！！使用 ajax 的方式，必须要自己建立一个 formData 的对象，用来存储提交的数据键值，同时还需要将 contentType 和 processData 都设为 false</strong>，完成后在使用 ajax 上传时，在请求头中会自动将 Content-Type 设置为 multipart/form-data</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lable</span>&gt;</span>请输入姓名<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lable</span>&gt;</span>请选择上传文件<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">id</span>=<span class="string">&quot;files&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">         $(<span class="string">&quot;#button&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">             formData.<span class="title function_">append</span>(<span class="string">&quot;name&quot;</span>, $(<span class="string">&quot;#name&quot;</span>).<span class="title function_">val</span>());</span></span><br><span class="line"><span class="language-javascript">             formData.<span class="title function_">append</span>(<span class="string">&quot;files&quot;</span>, $(<span class="string">&quot;#files&quot;</span>)[<span class="number">0</span>].<span class="property">files</span>[<span class="number">0</span>]);   </span></span><br><span class="line"><span class="language-javascript">             <span class="comment">// $(&quot;#files&quot;)[0].files[0] 获取文件对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">             $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">url</span>:<span class="string">&quot;/upload/&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">headers</span>: &#123;<span class="string">&quot;X-CSRFToken&quot;</span>: $.<span class="title function_">cookie</span>(<span class="string">&#x27;csrftoken&#x27;</span>)&#125;,  <span class="comment">// 从 cookie 中拿取 csrftoken</span></span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">data</span>: formData,        </span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">contentType</span>: <span class="literal">false</span>,    <span class="comment">// contentType 要设为 false</span></span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">processData</span>: <span class="literal">false</span>,    <span class="comment">// processDate 要是 false，不对数据做预处理</span></span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;上传成功&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                 &#125;</span></span><br><span class="line"><span class="language-javascript">             &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    )</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​    上面在 ajax 的请求中，是将 csrftoken 直接放在请求头中，使用到了 jquery-cookie，所以需要先引入 jquery 和 jquery-cookie</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/jquery/3.4.0/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​    除了使用 <code>$.cookie</code>，也可以将 csrftoken 放在提交给后端的数据中，通过获取到 csrftoken 的 input 标签，从而得到 token 的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">csrfmiddlewaretoken</span>:$(<span class="string">&#x27;[name=&quot;csrfmiddlewaretoken&quot;]&#x27;</span>).<span class="title function_">val</span>()</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Legacy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2197405715/">http://example.com/2197405715/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank"></a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="social-share" data-image="https://wei-foun.github.io/img/cover17.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/887545606/"><img class="prev-cover" src="https://wei-foun.github.io/img/cover18.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">LeetCode 原题</div></div></a></div><div class="next-post pull-right"><a href="/3660878595/"><img class="next-cover" src="https://wei-foun.github.io/img/cover16.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JavaScript 逆向爬取实例(下)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2213352412/" title="Gunicorn"><img class="cover" src="https://wei-foun.github.io/img/cover37.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-25</div><div class="title">Gunicorn</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Legacy</div><div class="author-info__description">冒险的生涯在召唤！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">30</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Live a life you will remember</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#MVC-%E5%92%8C-MTV-%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">MVC 和 MTV 架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MVC"><span class="toc-number">1.1.</span> <span class="toc-text">MVC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MTV"><span class="toc-number">1.2.</span> <span class="toc-text">MTV</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WSGI-%E5%92%8C-uWSGI"><span class="toc-number">2.</span> <span class="toc-text">WSGI 和 uWSGI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Django-%E8%AF%B7%E6%B1%82%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">3.</span> <span class="toc-text">Django 请求生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Django-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">Django 基本命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Django-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">Django 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">数据库配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.</span> <span class="toc-text">缓存配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#session-%E9%85%8D%E7%BD%AE"><span class="toc-number">5.3.</span> <span class="toc-text">session 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-number">5.4.</span> <span class="toc-text">日志配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Django-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">Django 中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL-%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">URL 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#url-%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">7.1.</span> <span class="toc-text">url 的注意点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%90%8D%E5%88%86%E7%BB%84%E5%92%8C%E6%9C%89%E5%90%8D%E5%88%86%E7%BB%84"><span class="toc-number">7.2.</span> <span class="toc-text">无名分组和有名分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#url-%E5%88%86%E5%8F%91"><span class="toc-number">7.3.</span> <span class="toc-text">url 分发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#url-%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-number">7.4.</span> <span class="toc-text">url 反向解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#url-%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4"><span class="toc-number">7.5.</span> <span class="toc-text">url 名称空间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpRequests-%E5%92%8C-HttpResponse-%E5%AF%B9%E8%B1%A1"><span class="toc-number">8.</span> <span class="toc-text">HttpRequests 和 HttpResponse 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpRequests-%E5%AF%B9%E8%B1%A1"><span class="toc-number">8.1.</span> <span class="toc-text">HttpRequests 对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpResponse-%E5%AF%B9%E8%B1%A1"><span class="toc-number">8.2.</span> <span class="toc-text">HttpResponse 对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FBV-%E5%92%8C-CBV"><span class="toc-number">9.</span> <span class="toc-text">FBV 和 CBV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95"><span class="toc-number">10.</span> <span class="toc-text">模板语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95%E8%87%AA%E5%B8%A6%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8%E6%96%B9%E6%B3%95"><span class="toc-number">10.1.</span> <span class="toc-text">模板语法自带的过滤器方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE%E4%B8%8E%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">10.2.</span> <span class="toc-text">自定义标签与过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">10.3.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">11.</span> <span class="toc-text">文件上传</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2133446919/" title="Linux再学习"><img src="https://wei-foun.github.io/img/cover46.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux再学习"/></a><div class="content"><a class="title" href="/2133446919/" title="Linux再学习">Linux再学习</a><time datetime="2025-07-12T06:58:04.000Z" title="发表于 2025-07-12 14:58:04">2025-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/4075015966/" title="GO 基础"><img src="https://wei-foun.github.io/img/cover45.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GO 基础"/></a><div class="content"><a class="title" href="/4075015966/" title="GO 基础">GO 基础</a><time datetime="2025-07-04T16:26:58.000Z" title="发表于 2025-07-05 00:26:58">2025-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/4209932858/" title="容器网络"><img src="https://wei-foun.github.io/img/cover44.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="容器网络"/></a><div class="content"><a class="title" href="/4209932858/" title="容器网络">容器网络</a><time datetime="2023-07-04T16:26:58.000Z" title="发表于 2023-07-05 00:26:58">2023-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/4253636491/" title="kubernetes-搭建"><img src="https://wei-foun.github.io/img/cover43.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kubernetes-搭建"/></a><div class="content"><a class="title" href="/4253636491/" title="kubernetes-搭建">kubernetes-搭建</a><time datetime="2023-03-19T10:39:02.000Z" title="发表于 2023-03-19 18:39:02">2023-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/" title="wsl docker 卸载"><img src="https://wei-foun.github.io/img/cover42.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="wsl docker 卸载"/></a><div class="content"><a class="title" href="/undefined/" title="wsl docker 卸载">wsl docker 卸载</a><time datetime="2023-03-05T08:50:50.000Z" title="发表于 2023-03-05 16:50:50">2023-03-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://wei-foun.github.io/img/cover17.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Legacy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'MHzSjOElX9Cf5IJAfoNr4COL-gzGzoHsz',
      appKey: 'K3d5HK6zRMD2BINwstEANt7H',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_親親":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再見":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_發怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_發財":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可愛":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_嘔吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_壞笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尷尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_驚嚇":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>